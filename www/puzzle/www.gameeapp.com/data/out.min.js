"use strict";
function ThreesGame(t) {
  var e = this, o = this;
  this.size = 640, this.backgroundUrl = "images/background.png", this.instructionsUrl = "images/instructions.png", this.numbers = [1, 2, 3, 6, 12, 24, 48, 96, 192, 384, 768, 1536, 3072, 6144], this.maxNum = 6144, this.spriteSize = 144, this.sprites = new Map, this.background = new Image, this.instructions = new Image, this.gameOverDelay = window.config.gameOverDelay, this.move = window.config.move, this.bump = window.config.bump, this.new = window.config.new, this.duration = this.new.start + this.new.duration, this.canvas = document.getElementById(t), this.canvas.width = this.size, this.canvas.height = this.size, this.ctx = this.canvas.getContext("2d"), this.audioCtx = new (window.AudioContext || window.webkitAudioContext), this.sounds = ["spojeni", "novecislo"], this.gridSize = 4, this.grid = new Array(this.gridSize * this.gridSize), this.food = 1, this.canMove = new Set, this.animations = [], this.time = 0, this.score = 0, this.overlay = 1, this.state = this.instructionsShow, this.render = this.instructionsRender, this.paused = 0, this.muted = 0, this.controller = gamee.controller.requestController("FourArrows", {enableKeyboard: !0}), this.keyPressed = 0, this.controller.buttons.left.on("keydown", this.keyFunc(this.controller.buttons.left.keyCode)), this.controller.buttons.up.on("keydown", this.keyFunc(this.controller.buttons.up.keyCode)), this.controller.buttons.right.on("keydown", this.keyFunc(this.controller.buttons.right.keyCode)), this.controller.buttons.down.on("keydown", this.keyFunc(this.controller.buttons.down.keyCode)), this.directions = new Map([[this.controller.buttons.left.keyCode, [1, 0]], [this.controller.buttons.up.keyCode, [0, 1]], [this.controller.buttons.right.keyCode, [-1, 0]], [this.controller.buttons.down.keyCode, [0, -1]]]), gamee.onPause = function () {
    e.paused = 1, e.keyPressed = 0
  }, gamee.onResume = gamee.onUnpause = function () {
    e.paused = 0, e.keyPressed = 0
  }, gamee.onRestart = function () {
    e.playSilentSound(), e.overlay = 0, e.paused = 0, e.keyPressed = 0, e.state = e.instructionsShow, e.render = e.instructionsRender, gamee.gameStart()
  }, gamee.onMute = function () {
    e.muted = 1
  }, gamee.onUnmute = function () {
    e.muted = 0
  }, gamee.onStop = function () {
  }, this.initSprites(function () {
    o.preloadSounds.call(o, function () {
      gamee.gameLoaded(), requestAnimationFrame(function (t) {
        return o.mainLoop.call(o, t)
      })
    })
  })
}
function preloadImgs(t, e) {
  var o = 0;
  t.forEach(function (n) {
    var i = n[0], r = n[1];
    r.onload = function () {
      ++o == t.length && e && e()
    }, r.onerror = function () {
    }, r.onabort = function () {
    }, r.src = i
  })
}
!function (t, e, o) {
  function n(t, e) {
    return typeof t === e
  }

  function i() {
    var t, e, o, i, r, s, c;
    for (var h in u)if (u.hasOwnProperty(h)) {
      if (t = [], e = u[h], e.name && (t.push(e.name.toLowerCase()), e.options && e.options.aliases && e.options.aliases.length))for (o = 0; o < e.options.aliases.length; o++)t.push(e.options.aliases[o].toLowerCase());
      for (i = n(e.fn, "function") ? e.fn() : e.fn, r = 0; r < t.length; r++)s = t[r], c = s.split("."), 1 === c.length ? d[c[0]] = i : (!d[c[0]] || d[c[0]] instanceof Boolean || (d[c[0]] = new Boolean(d[c[0]])), d[c[0]][c[1]] = i), a.push((i ? "" : "no-") + c.join("-"))
    }
  }

  function r(t) {
    var e = h.className, o = d._config.classPrefix || "";
    if (p && (e = e.baseVal), d._config.enableJSClass) {
      var n = new RegExp("(^|\\s)" + o + "no-js(\\s|$)");
      e = e.replace(n, "$1" + o + "js$2")
    }
    d._config.enableClasses && (e += " " + o + t.join(" " + o), p ? h.className.baseVal = e : h.className = e)
  }

  function s() {
    return "function" != typeof e.createElement ? e.createElement(arguments[0]) : p ? e.createElementNS.call(e, "http://www.w3.org/2000/svg", arguments[0]) : e.createElement.apply(e, arguments)
  }

  var a = [], u = [], c = {
    _version: "3.3.1",
    _config: {classPrefix: "", enableClasses: !0, enableJSClass: !0, usePrefixes: !0},
    _q: [],
    on: function (t, e) {
      var o = this;
      setTimeout(function () {
        e(o[t])
      }, 0)
    },
    addTest: function (t, e, o) {
      u.push({name: t, fn: e, options: o})
    },
    addAsyncTest: function (t) {
      u.push({name: null, fn: t})
    }
  }, d = function () {
  };
  d.prototype = c, d = new d;
  var h = e.documentElement, p = "svg" === h.nodeName.toLowerCase();
  d.addTest("audio", function () {
    var t = s("audio"), e = !1;
    try {
      (e = !!t.canPlayType) && (e = new Boolean(e), e.ogg = t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/, ""), e.mp3 = t.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/, ""), e.opus = t.canPlayType('audio/ogg; codecs="opus"') || t.canPlayType('audio/webm; codecs="opus"').replace(/^no$/, ""), e.wav = t.canPlayType('audio/wav; codecs="1"').replace(/^no$/, ""), e.m4a = (t.canPlayType("audio/x-m4a;") || t.canPlayType("audio/aac;")).replace(/^no$/, ""))
    } catch (t) {
    }
    return e
  }), i(), r(a), delete c.addTest, delete c.addAsyncTest;
  for (var l = 0; l < d._q.length; l++)d._q[l]();
  t.Modernizr = d
}(window, document), function () {
  var t = function () {
    var t = this, e = {};
    t.on = function (t, o, n) {
      if (!(arguments.length < 2 || "string" != typeof t || "function" != typeof o)) {
        var i = o.toString();
        "undefined" != typeof e[t] ? "undefined" == typeof e[t].callbacks[i] ? e[t].callbacks[i] = {
          cb: o,
          once: !!n
        } : "boolean" == typeof n && (e[t].callbacks[i].once = n) : (e[t] = {callbacks: {}}, e[t].callbacks[i] = {
          cb: o,
          once: !!n
        })
      }
    }, t.once = function (e, o) {
      t.on(e, o, !0)
    }, t.off = function (t, o) {
      if ("string" == typeof t && "undefined" != typeof e[t])if ("function" == typeof o) {
        var n = o.toString(), i = e[t].callbacks[n];
        "undefined" != typeof i && delete e[t].callbacks[n]
      } else delete e[t]
    }, t.trigger = function (o, n) {
      if ("string" == typeof o && "undefined" != typeof e[o])for (var i in e[o].callbacks) {
        var r = e[o].callbacks[i];
        "function" == typeof r.cb && r.cb(n), "boolean" == typeof r.once && r.once === !0 && t.off(o, r.cb)
      }
    }
  };
  "undefined" != typeof define && define.amd ? define(function () {
    return new t
  }) : "undefined" != typeof module && module.exports ? module.exports = new t : window.Bullet = new t
}(), function (t) {
  function e(t) {
    t.updateScore = function (t) {
      window.location.href = "gamee://score/" + t
    }, t.requestController = function (t) {
      window.location.href = "gamee://request-controller/" + t
    }, t.gameOver = function () {
      window.location.href = "gamee://game-over"
    }, t.gameStart = function () {
      window.location.href = "gamee://game-start"
    }, t.gameLoaded = function () {
      window.location.href = "gamee://game-loaded"
    }, t.type = "gamee-mobile"
  }

  function o(t) {
    var e = window.parent.gameeSimulator;
    t.updateScore = function (t) {
      e.updateScore(t)
    }, t.requestController = function (t) {
      e.requestController(t)
    }, t.gameOver = function () {
      e.gameOver()
    }, t.gameStart = function () {
      e.gameStart()
    }, t.gameLoaded = function () {
      e.gameLoaded()
    }, t.type = "gamee-simulator"
  }

  function n(t) {
    var e = window.parent;
    t.updateScore = function (t) {
      e.postMessage(["score", t], "*")
    }, t.requestController = function (t) {
      e.postMessage(["request-controller", t], "*")
    }, t.additionalController = function (t) {
      e.postMessage(["additional-controller", t], "*")
    }, t.gameOver = function () {
      e.postMessage(["game-over"], "*")
    }, t.gameStart = function () {
      e.postMessage(["game-start"], "*")
    }, t.gamePaused = function () {
      e.postMessage(["game-paused"], "*")
    }, t.gameLoaded = function () {
      e.postMessage(["game-loaded"], "*")
    }, t.type = "gamee-web"
  }

  var i = {
    updateScore: function (t) {
    }, requestController: function (t) {
    }, additionalController: function (t) {
    }, gameOver: function () {
    }, gameStart: function () {
    }, gameLoaded: function () {
    }, type: "no-gamee"
  }, r = navigator.userAgent.toLowerCase();
  /iphone|ipod|ipad/.test(r) ? window.self !== window.top ? n(i) : e(i) : /gamee\/[0-9\.]+$/.test(r) ? e(i) : window.parent ? n(i) : window.parent && window.parent.gameeSimulator ? o(i) : console.error("No gamee enviroment matched"), t.$gameeNative = i
}(this);
var gamee = function (t) {
  function e(t, e, o) {
    t.addEventListener ? t.addEventListener(e, o, !1) : t.attachEvent && t.attachEvent("on" + e, o)
  }

  function o(t) {
    return function (e) {
      return e && e.keyCode || (e || (e = window.event), e.which && (e.keyCode = e.which)), t(e)
    }
  }

  var n, i = function () {
  }, r = {};
  return Object.defineProperty(r, "score", {
    get: function () {
      return n
    }, set: function (e) {
      n = e, t.$gameeNative.updateScore(n)
    }
  }), r.gameOver = function () {
    t.$gameeNative.gameOver()
  }, r.gameStart = function () {
    t.$gameeNative.gameStart()
  }, r.gameLoaded = function () {
    t.$gameeNative.gameLoaded()
  }, r.onPause = i, r.onStop = i, r.onRestart = i, r.onMute = i, r.onUnmute = i, r.onUnpause = i, r.onResume = function () {
    r.onUnpause()
  }, r._keydown = function (n) {
    e(t, "keydown", o(n))
  }, r._keyup = function (n) {
    e(t, "keyup", o(n))
  }, "gamee-web" === t.$gameeNative.type && (r._keydown(function (t) {
    switch (t.keyCode) {
      case 80:
        r.onPause(), $gameeNative.gamePaused();
        break;
      case 82:
        r.onRestart()
    }
  }), e(t, "message", function (t) {
    switch (t.data[0]) {
      case"pause":
        r.onPause();
        break;
      case"resume":
        r.onResume();
        break;
      case"restart":
        window.focus(), r.onRestart();
        break;
      case"mute":
        r.onMute();
        break;
      case"button_button_down":
        r.controller.trigger("keydown", {button: "button"});
        break;
      case"button_button_up":
        r.controller.trigger("keyup", {button: "button"});
        break;
      case"button_left_up":
        r.controller.trigger("keyup", {button: "left"});
        break;
      case"button_left_down":
        r.controller.trigger("keydown", {button: "left"});
        break;
      case"button_right_down":
        r.controller.trigger("keydown", {button: "right"});
        break;
      case"button_right_up":
        r.controller.trigger("keyup", {button: "right"});
        break;
      case"button_up_down":
        r.controller.trigger("keydown", {button: "up"});
        break;
      case"button_up_up":
        r.controller.trigger("keyup", {button: "up"});
        break;
      case"button_down_down":
        r.controller.trigger("keydown", {button: "down"});
        break;
      case"button_down_up":
        r.controller.trigger("keyup", {button: "down"});
        break;
      case"button_a_down":
        r.controller.trigger("keydown", {button: "A"});
        break;
      case"button_a_up":
        r.controller.trigger("keyup", {button: "A"});
        break;
      case"button_b_down":
        r.controller.trigger("keydown", {button: "B"});
        break;
      case"button_b_up":
        r.controller.trigger("keyup", {button: "B"});
        break;
      default:
        throw Error("Unknown message")
    }
  })), r
}(this);
!function (t, e) {
  function o(t, e) {
    var o = this;
    g.call(this), this._pressed = !0, this.key = t, this.keyCode = e, this.on("keydown", function () {
      o._pressed = !0
    }), this.on("keyup", function () {
      o._pressed = !1
    })
  }

  function n() {
    var t = this;
    g.call(this), this.buttons = {}, this.buttonAlias = {}, this.on("$keydown", function (e) {
      e.button && t.buttonAlias[e.button] && (e.button = t.buttonAlias[e.button]), t.trigger("keydown", e)
    }), this.on("$keyup", function (e) {
      e.button && t.buttonAlias[e.button] && (e.button = t.buttonAlias[e.button]), t.trigger("keyup", e)
    }), this.on("keydown", function (e) {
      e.button && t.buttons[e.button] && t.buttons[e.button].trigger("keydown")
    }), this.on("keyup", function (e) {
      e.button && t.buttons[e.button] && t.buttons[e.button].trigger("keyup")
    })
  }

  function i() {
    n.call(this), this.addButton(new o("button", 32))
  }

  function r() {
    n.call(this), this.addButton(new o("left", 37)), this.addButton(new o("right", 39))
  }

  function s() {
    n.call(this), this.addButton(new o("up", 38)), this.addButton(new o("left", 37)), this.addButton(new o("right", 39)), this.addButton(new o("A", 32))
  }

  function a() {
    n.call(this), this.addButton(new o("up", 38)), this.addButton(new o("left", 37)), this.addButton(new o("right", 39)), this.addButton(new o("down", 40)), this.addButton(new o("A", 32))
  }

  function u() {
    n.call(this), this.addButton(new o("up", 38)), this.addButton(new o("left", 37)), this.addButton(new o("right", 39)), this.addButton(new o("down", 40)), this.addButton(new o("A", 32)), this.addButton(new o("B", 17))
  }

  function c() {
    n.call(this), this.addButton(new o("up", 38)), this.addButton(new o("left", 37)), this.addButton(new o("right", 39)), this.addButton(new o("down", 40))
  }

  function d() {
    var t = this;
    n.call(this), this.on("$touchstart", function (e) {
      t.trigger("touchstart", e)
    }), this.on("$touchend", function (e) {
      t.trigger("touchend", e)
    }), this.on("$touchmove", function (e) {
      t.trigger("touchmove", e)
    }), this.on("$touchleave", function (e) {
      t.trigger("touchleave", e)
    }), this.on("$touchcancel", function (e) {
      t.trigger("touchcancel", e)
    })
  }

  function h() {
    var t = this;
    n.call(this), this.x = 0, this.y = 0, this.on("$change", function (e) {
      t.x = e.position.x, t.y = e.position.y, t.trigger("change", e)
    })
  }

  function p() {
    h.call(this), this.addButton(new o("button", 32))
  }

  function l(t, e) {
    var o, n;
    if (!m[t])throw new Error("Unsupported controller type, " + t);
    if (e = e || {}, n = new m[t], e.enableKeyboard && n.enableKeyboard(), e.buttons)for (o in e.buttons)n.remapButton(o, e.buttons[o]);
    return n
  }

  var g = Bullet.constructor;
  e.controller = {
    requestController: function (e, o) {
      var n = l(e, o);
      return t.$gameeNative.requestController(e), f = n, n
    }, additionalController: function (e, o) {
      var n = l(e, o);
      return t.$gameeNative.additionalController(e), n
    }, trigger: function () {
      if (!f)throw new Error("No controller present");
      f.trigger.apply(f, arguments)
    }
  }, o.prototype = Object.create(g.constructor.prototype), o.constructor = o, o.prototype.isDown = function () {
    return this._pressed
  }, n.prototype = Object.create(g.constructor.prototype), n.constructor = n, n.prototype.addButton = function (t) {
    this.buttons[t.key] = t
  }, n.prototype.enableKeyboard = function () {
    var t, o, n = {}, i = this;
    for (t in this.buttons)o = this.buttons[t], o.keyCode && (n[o.keyCode] = o);
    e._keydown(function (t) {
      var e = n[t.keyCode];
      e && (t.preventDefault(), i.trigger("keydown", {button: e.key}))
    }), e._keyup(function (t) {
      var e = n[t.keyCode];
      e && (t.preventDefault(), i.trigger("keyup", {button: e.key}))
    })
  }, n.prototype.remapButton = function (t, e) {
    if (e.name && (e = e.name), !this.buttons[t])throw Error("Button " + t + " was not found in controller");
    this.buttonAlias[t] = e.name, this.buttons[e.name] = this.buttons[t], delete this.buttons[t]
  }, i.prototype = Object.create(n.prototype), i.prototype.constructor = i, r.prototype = Object.create(n.prototype), r.prototype.constructor = r, s.prototype = Object.create(n.prototype), s.prototype.constructor = s, a.prototype = Object.create(n.prototype), a.prototype.constructor = a, u.prototype = Object.create(n.prototype), u.prototype.constructor = u, c.prototype = Object.create(n.prototype), c.prototype.constructor = c, d.prototype = Object.create(d.prototype), d.prototype.constructor = d, h.prototype = Object.create(n.prototype), h.prototype.constructor = h, p.prototype = Object.create(h.prototype), p.prototype.constructor = p;
  var f, m = {
    OneButton: i,
    TwoButtons: r,
    FourButtons: s,
    FiveButtons: a,
    SixButtons: u,
    FourArrows: c,
    Touch: d,
    Joystick: h,
    JoystickWithButton: p
  }
}(this, gamee), window.config = {
  move: {start: 0, duration: 10 / 60 * 1e3, fn: "exp"},
  bump: {start: 7 / 60 * 1e3, duration: 200, size1: .2, size2: 1.4},
  new: {start: 14 / 60 * 1e3, duration: 100, size1: .2},
  gameOverDelay: 1e3
}, ThreesGame.prototype.keyFunc = function (t) {
  var e = this;
  return function () {
    e.overlay && (e.playSilentSound(), gamee.gameStart(), e.overlay = 0), e.keyPressed = t
  }
}, ThreesGame.prototype.preloadSounds = function (t) {
  var e = 0, o = this, n = [];
  "probably" == Modernizr.audio.ogg ? ".ogg" : "probably" == Modernizr.audio.mp3 ? ".mp3" : ".wav";
  this.sounds.forEach(function (i, r) {
    var s = new XMLHttpRequest, a = "http://dagala.ir/puzzle/www.gameeapp.com/data/sounds/" + i + ".wav";
    s.open("GET", a, !0), s.responseType = "arraybuffer", s.onload = function () {
      o.audioCtx.decodeAudioData(s.response, function (r) {
        n.push([i, {buffer: r, played: 0}]), ++e == o.sounds.length && t && (o.sounds = new Map(n), t())
      })
    }, s.send()
  })
}, ThreesGame.prototype.playSound = function (t, e) {
  if (!(this.overlay || this.muted || this.sounds.get(t).played)) {
    var o = this.audioCtx, n = this.sounds.get(t), i = o.createBufferSource();
    i.buffer = n.buffer, i.connect(o.destination), i.start(o.currentTime + e), n.played = 1
  }
}, ThreesGame.prototype.playSilentSound = function () {
  var t = this.audioCtx, e = t.createBufferSource(), o = t.createGain();
  o.gain.value = 0, e.connect(o), o.connect(t.destination), e.start(0, 0, 1)
}, ThreesGame.prototype.resetSounds = function () {
  this.sounds.forEach(function (t) {
    return t.played = 0
  })
}, ThreesGame.prototype.initSprites = function (t) {
  var e = [];
  this.sprites = new Map(this.numbers.map(function (t) {
    var o = new Image, n = "images/" + t.toString() + ".png";
    return e.push([n, o]), [t, o]
  })), e.push([this.instructionsUrl, this.instructions]), e.push([this.backgroundUrl, this.background]), preloadImgs(e, t)
}, ThreesGame.prototype.initGrid = function () {
  var t = [];
  this.grid.fill(0);
  var e = this.gridSize * this.gridSize, o = Math.floor(Math.random() * e), n = Math.floor(Math.random() * (e - 1)) + 1, i = (o + n) % e, r = this.getPos(o), s = this.getPos(i);
  this.setGrid(r, 1), this.setGrid(s, 2), t.push({type: "new", num: 1, where: r}), t.push({
    type: "new",
    num: 2,
    where: s
  }), this.animations = t
}, ThreesGame.prototype.drawGrid = function (t) {
  var e = this, o = Math.round((this.size - this.gridSize * this.spriteSize) / (this.gridSize + 1)), n = function (t) {
    return t * (e.spriteSize + o) + o
  };
  t.drawImage(this.background, 0, 0);
  for (var i = 0; i < this.gridSize; i++)for (var r = 0; r < this.gridSize; r++) {
    var s = this.getGrid([r, i]);
    s && t.drawImage(this.sprites.get(s), n(r), n(i))
  }
}, ThreesGame.prototype.drawInfo = function (t) {
}, ThreesGame.prototype.animateGrid = function (t, e) {
  var o = this, n = Math.round((this.size - this.gridSize * this.spriteSize) / (this.gridSize + 1)), i = function (t) {
    return Math.round(t * (o.spriteSize + n)) + n
  }, r = function (t, e, o) {
    return t + (e - t) * o
  }, s = function (t, e, o) {
    return r(t, e, Math.pow(o, 2))
  }, a = function (t, e, o, n) {
    return n <= .5 ? r(t, e, 2 * n) : r(e, o, 2 * (n - .5))
  }, u = "exp" == this.move.fn ? s : "lin" == this.move.fn ? r : r;
  t.drawImage(this.background, 0, 0), this.animations.forEach(function (n) {
    switch (n.type) {
      case"move":
        if (!(e >= o.move.start && e <= o.move.start + o.move.duration)) {
          t.drawImage(o.sprites.get(n.num), i(n.where[0]), i(n.where[1]));
          break
        }
        var s = (e - o.move.start) / o.move.duration, c = u(n.from[0], n.where[0], s), d = u(n.from[1], n.where[1], s);
        t.drawImage(o.sprites.get(n.num), i(c), i(d));
        break;
      case"bump":
        if (!(e >= o.bump.start && e <= o.bump.start + o.bump.duration)) {
          e >= o.bump.start + o.bump.duration && t.drawImage(o.sprites.get(n.num), i(n.where[0]), i(n.where[1]));
          break
        }
        var h = (e - o.bump.start) / o.bump.duration, p = Math.round(o.spriteSize * a(o.bump.size1, o.bump.size2, 1, h)), l = Math.round((o.spriteSize - p) / 2);
        t.drawImage(o.sprites.get(n.num), i(n.where[0]) + l, i(n.where[1]) + l, p, p), o.playSound("spojeni", 0);
        break;
      case"new":
        if (!(e >= o.new.start && e <= o.new.start + o.new.duration))break;
        var g = (e - o.new.start) / o.new.duration, f = Math.round(o.spriteSize * r(o.new.size1, 1, g)), m = Math.round((o.spriteSize - f) / 2);
        t.drawImage(o.sprites.get(n.num), i(n.where[0]) + m, i(n.where[1]) + m, f, f), o.playSound("novecislo", 0)
    }
  })
}, ThreesGame.prototype.getKey = function () {
  var t = this.keyPressed;
  return this.keyPressed = 0, t
}, ThreesGame.prototype.setGrid = function (t, e) {
  this.grid[t[1] * this.gridSize + t[0]] = e
}, ThreesGame.prototype.getGrid = function (t) {
  return this.grid[t[1] * this.gridSize + t[0]]
}, ThreesGame.prototype.getPos = function (t) {
  return [t % this.gridSize, Math.floor(t / this.gridSize)]
}, ThreesGame.prototype.moveGrid = function (t, e) {
  var o = void 0, n = void 0, i = void 0, r = void 0, s = void 0, a = [], u = 0;
  t[0] ? (o = t[0], i = o > 0 ? 0 : this.gridSize - 1, s = o > 0 ? this.gridSize - 1 : 0, r = 0, n = this.gridSize) : (o = t[1] * this.gridSize, i = o > 0 ? 0 : (this.gridSize - 1) * this.gridSize, s = o > 0 ? (this.gridSize - 1) * this.gridSize : 0 * this.gridSize, r = 0, n = 1);
  for (var c = r, d = 0; d < this.gridSize; c += n, d++)for (var h = 0, p = 0, l = void 0, g = void 0, f = i, m = 0; m < this.gridSize; f += o, m++) {
    var y = c + f, w = this.grid[y];
    0 == h && w && (h = w, l = y), 0 != h && (g = l == c + s ? l : l + o, p = l != g ? this.grid[g] : 0);
    var b = l == c + i ? l : l - o, v = this.grid[b], k = 0 == v ? b : l;
    h + p == 3 && h * p != 0 || h > 2 && h < this.maxNum && h == p ? (a.push({
      type: "move",
      num: h,
      from: this.getPos(l),
      where: this.getPos(k)
    }), a.push({type: "move", num: p, from: this.getPos(g), where: this.getPos(k)}), a.push({
      type: "bump",
      num: h + p,
      where: this.getPos(k)
    }), e || (this.score += h + p, gamee.score = this.score, this.setGrid(this.getPos(g), 0), this.setGrid(this.getPos(l), 0), this.setGrid(this.getPos(k), h + p)), h = 0, u = 1) : h && (a.push({
      type: "move",
      num: h,
      from: this.getPos(l),
      where: this.getPos(k)
    }), e || (this.setGrid(this.getPos(l), 0), this.setGrid(this.getPos(k), h)), l != k && (u = 1), h = p, l = g)
  }
  return e || (this.animations = a), u
}, ThreesGame.prototype.plantFood = function (t) {
  var e = void 0, o = void 0, n = void 0, i = void 0, r = [];
  t[0] ? (e = t[0] > 0 ? this.gridSize - 1 : 0, n = e, o = 0, i = this.gridSize - 1) : (o = t[1] > 0 ? this.gridSize - 1 : 0, i = o, e = 0, n = this.gridSize - 1);
  for (var s = e; s <= n; s++)for (var a = o; a <= i; a++) {
    var u = [s, a];
    this.getGrid(u) || r.push(u)
  }
  var c = r[Math.floor(Math.random() * r.length)];
  this.setGrid(c, this.food), this.animations.push({
    type: "new",
    num: this.food,
    where: c
  }), this.food = 1 == this.food ? 2 : 1
}, ThreesGame.prototype.checkDirections = function () {
  var t = this;
  this.canMove = new Set, Array.from(this.directions.entries(), function (t) {
    return t[1]
  }).forEach(function (e) {
    t.moveGrid(e, !0) && t.canMove.add(e)
  })
}, ThreesGame.prototype.instructionsShow = function (t) {
  var e = this.getKey();
  e && (this.state = this.newGame)
}, ThreesGame.prototype.newGame = function (t) {
  this.keyPressed = 0, this.initGrid(), this.checkDirections(), this.score = 0, this.state = this.animation, this.render = this.animationRender, this.resetSounds(), this.time = t
}, ThreesGame.prototype.animation = function (t) {
  (t - this.time >= this.duration || this.keyPressed) && (this.keyPressed && !this.sounds.get("novecislo").played && this.playSound("novecislo", 0), this.render = this.fullRender, this.state = this.gameplay)
}, ThreesGame.prototype.gameplay = function (t) {
  if (!this.canMove.size)return this.state = this.gameOver, this.render = this.dummyRender, void(this.time = t);
  var e = this.getKey();
  if (e) {
    var o = this.directions.get(e);
    this.canMove.has(o) && (this.moveGrid(o), this.plantFood(o), this.checkDirections(), this.time = t, this.resetSounds(), this.render = this.animationRender, this.state = this.animation)
  }
}, ThreesGame.prototype.gameOver = function (t) {
  t - this.time >= this.gameOverDelay && (this.state = this.dummyState, gamee.gameOver())
}, ThreesGame.prototype.dummyState = function () {
}, ThreesGame.prototype.instructionsRender = function () {
  this.ctx.drawImage(this.instructions, 0, 0), this.render = this.dummyRender
}, ThreesGame.prototype.fullRender = function () {
  this.drawGrid(this.ctx, !1), this.render = this.dummyRender
}, ThreesGame.prototype.animationRender = function (t) {
  this.animateGrid(this.ctx, t - this.time)
}, ThreesGame.prototype.dummyRender = function () {
}, ThreesGame.prototype.mainLoop = function (t) {
  var e = this;
  this.paused || (this.state(t), this.render(t)), requestAnimationFrame(function (t) {
    return e.mainLoop.call(e, t)
  })
};
var game = new ThreesGame("pane");
