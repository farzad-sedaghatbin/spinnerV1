var Meteoric;!function(e){var t=function(){function e(){}return e.GAMEE=!0,e.game=null,e.GAME_WIDTH=640,e.GAME_HEIGHT=640,e.MAX_GAME_WIDTH=640,e.MAX_GAME_HEIGHT=640,e.scaleX=1,e.scaleY=1,e.correctOrientation=!1,e.musicOn=!0,e.soundOn=!0,e.showLanguages=!1,e.supportedLanguages=["en"],e.currentLanguage="en",e}();e.Global=t}(Meteoric||(Meteoric={})),window.onload=function(){var e=new Gamee.Gamee("FourArrows",!0),t=new Meteoric.Game;Meteoric.Global.game=t,e.setGame(t)};var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},Meteoric;!function(e){var t=function(t){function i(){var n=(window.innerWidth,window.innerHeight,Utils.ScreenUtils.calculateScreenMetrics(e.Global.GAME_WIDTH,e.Global.GAME_HEIGHT,Utils.Orientation.PORTRAIT,e.Global.MAX_GAME_WIDTH,e.Global.MAX_GAME_HEIGHT)),o=Phaser.AUTO;t.call(this,{width:n.gameWidth,height:n.gameHeight,renderer:o,parent:"content",transparent:!1,antialias:!0,physicsConfig:null,preserveDrawingBuffer:!0}),i.game=this,Utils.PhaserUtils.ChangeAnimationPhaserJSONData(this.additionalFrameProperties),Utils.PhaserUtils.AdjustTweenFunctions(),this.state.add("Boot",e.Boot),this.state.add("Preloader",e.Preloader),this.state.add("Menu",e.Menu),this.state.add("Play",e.Play),this.state.start("Boot")}return __extends(i,t),i.prototype.onMute=function(){Utils.AudioUtils.stopMusic(),e.Global.soundOn=!1,e.Global.musicOn=!1},i.prototype.onUnmute=function(){e.Global.soundOn=!0,e.Global.musicOn=!0},i.prototype.additionalFrameProperties=function(e,t){t.anchor&&(e.anchorX=t.anchor.w,e.anchorY=t.anchor.h),t.nextitem&&(e.nextItemX=t.nextitem.w,e.nextItemY=t.nextitem.h)},i}(Phaser.Game);e.Game=t}(Meteoric||(Meteoric={}));var Gamee;!function(e){var t=function(){function e(t,i){void 0===i&&(i=!1),this._game=null,this._gameeController=null,this._indices={right:1,up:2,left:4,down:8,A:16,B:32,button:64},this._pressesCache=0,this._isDown=0,this._justDown=0,this._justUp=0,this._gameRunning=!1,this._score=0,void 0!==window.gamee&&("Touch"!==t?(this._gameeController=window.gamee.controller.requestController(t,{enableKeyboard:i}),this.keyHandlers()):(this._gameeController=window.gamee.controller.requestController("Touch"),this.touchHandlers())),this.eventHandlers(),e._instance=this}return Object.defineProperty(e,"instance",{get:function(){return null===e._instance,e._instance},enumerable:!0,configurable:!0}),e.prototype.setGame=function(e){this._game=e},Object.defineProperty(e.prototype,"gameRunning",{get:function(){return this._gameRunning},enumerable:!0,configurable:!0}),e.prototype.keyHandlers=function(){var e=this;this._gameeController.on("keydown",function(t){e._pressesCache|=e._indices[t.button];var i=e._game.state.getCurrentState();"function"==typeof i.onGameeButtonDown&&i.onGameeButtonDown(t.button)}),this._gameeController.on("keyup",function(t){e._pressesCache&=~e._indices[t.button];var i=e._game.state.getCurrentState();"function"==typeof i.onGameeButtonUp&&i.onGameeButtonUp(t.button)})},e.prototype.processKeys=function(){var e=this._isDown;this._isDown=this._pressesCache;var t=e^this._isDown;this._justDown=t&this._isDown,this._justUp=t&~this._isDown},e.prototype.clearKeys=function(){this._pressesCache=0,this._isDown=0,this._justDown=0,this._justUp=0},e.prototype.isDown=function(e){return(this._isDown&this._indices[e])>0},e.prototype.justDown=function(e){return(this._justDown&this._indices[e])>0},Object.defineProperty(e.prototype,"anyIsDown",{get:function(){return this._isDown>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anyJustDown",{get:function(){return this._justDown>0},enumerable:!0,configurable:!0}),e.prototype.isUp=function(e){return!this.isDown(e)},e.prototype.justUp=function(e){return(this._justUp&this._indices[e])>0},e.prototype.touchHandlers=function(){var e=this;this._gameeController.on("touchstart",function(t){var i=e._game.state.getCurrentState();"function"==typeof i.onGameeTouchStart&&i.onGameeTouchStart(t)}),this._gameeController.on("touchend",function(t){var i=e._game.state.getCurrentState();"function"==typeof i.onGameeTouchEnd&&i.onGameeTouchEnd(t)}),this._gameeController.on("touchmove",function(t){var i=e._game.state.getCurrentState();"function"==typeof i.onGameeTouchMove&&i.onGameeTouchMove(t)}),this._gameeController.on("touchleave",function(t){var i=e._game.state.getCurrentState();"function"==typeof i.onGameeTouchLeave&&i.onGameeTouchLeave(t)}),this._gameeController.on("touchcancel",function(t){var i=e._game.state.getCurrentState();"function"==typeof i.onGameeTouchCancel&&i.onGameeTouchCancel(t)})},e.prototype.eventHandlers=function(){var e=this;window.gamee.onPause=function(){e.onPause()},window.gamee.onUnpause=function(){e.onUnpause()},window.gamee.onRestart=function(){e.onRestart()},window.gamee.onMute=function(){e._game.onMute()},window.gamee.onUnmute=function(){e._game.onUnmute()}},e.prototype.onPause=function(){var e=this._game.state.getCurrentState();"function"==typeof e.onGameePause&&e.onGameePause()},e.prototype.onUnpause=function(){var e=this._game.state.getCurrentState();"function"==typeof e.onGameeUnpause&&e.onGameeUnpause()},e.prototype.onRestart=function(){var e=this._game.state.getCurrentState();"function"==typeof e.onGameeRestart&&e.onGameeRestart()},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},set:function(e){this._score=e,window.gamee.score=e},enumerable:!0,configurable:!0}),e.prototype.addScore=function(e){this.score+=e},e.prototype.gameStart=function(){this._gameRunning,window.gamee.gameStart(),this._gameRunning=!0},e.prototype.gameOver=function(){!this._gameRunning,window.gamee.gameOver(),this._gameRunning=!1},e._instance=null,e}();e.Gamee=t}(Gamee||(Gamee={}));var Helper;!function(e){var t=function(){function e(){}return e.randomizeArray=function(e,t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var o=i?t.slice():t;return Phaser.ArrayUtils.shuffle(o),n?o.slice(0,e):o},e.sort=function(t,i,n,o){if(void 0===n&&(n=0),void 0===o&&(o=t.length),o>n){for(var a,s=n,r=n+1;o>=r;r++)i(t[n],t[r])>0&&(a=t[++s],t[s]=t[r],t[r]=a);a=t[n],t[n]=t[s],t[s]=a,e.sort(t,i,n,s-1),e.sort(t,i,s+1,o)}},e}();e.ArrayUtils=t}(Helper||(Helper={}));var Meteoric;!function(e){var t;!function(e){function t(e,t,i){var n=e*Math.PI*2*t,o=e*(2*Math.PI*i+Math.PI/2);return Math.sin(n)*Math.cos(o)}function i(e,t,i){var n=e*Math.PI*2*t,o=-e*i;return Math.sin(n)*Math.exp(o)}function n(e){return-2*e*e+3*e}function o(e){return-(n(1-e)-1)}function a(e){return Math.sin(2*e*Math.PI)}function s(e){return Math.sin(e*Math.PI)}function r(e,t){return Math.sin(2*e*Math.PI*t)}e.wiggle=t,e.sinWithExpDecay=i,e.pop5=n,e.pop5rev=o,e.sin=a,e.halfSin=s,e.sinWithPeriod=r}(t=e.Easing||(e.Easing={}))}(Meteoric||(Meteoric={}));var Helper;!function(e){var t=function(){function e(){}return e.create=function(t,i,n,o,a,s,r,l,h,c){return void 0===s&&(s=0),void 0===r&&(r=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===c&&(c=!1),e._image=new Phaser.Image(t,0,0,o),"string"==typeof a?e._frame=t.cache.getFrameByName(o,a):e._frame=t.cache.getFrameByIndex(o,a),e.calculateNineImage(i,n,s,r,l,h,c),e._nineImage=new Phaser.BitmapData(t,"NineImage"+e._textureKey++,e._width,e._height),e.renderNineImage(),e._nineImage},e.calculateNineImage=function(t,i,n,o,a,s,r){var l=e._frame;if(e._centralWidth=l.width-o-s,e._centralHeight=l.height-n-a,r)e._horizontalRepeats=t,e._verticalRepeats=i,e._width=o+s+e._centralWidth*t,e._height=n+a+e._centralHeight*i,e._lastWidth=0,e._lastHeight=0;else{var h=t-o-s;e._horizontalRepeats=Math.floor(h/e._centralWidth),e._lastWidth=h%e._centralWidth;var c=i-n-a;e._verticalRepeats=Math.floor(c/e._centralHeight),e._lastHeight=c%e._centralHeight,e._width=t,e._height=i}e._leftWidth=o,e._rightWidth=s,e._topHeight=n,e._bottomHeight=a},e.renderNineImage=function(){var t=e._frame.y,i=0;e._topHeight>0&&(e.renderNineImageRow(e._image,t,i,e._topHeight),t+=e._topHeight,i+=e._topHeight);for(var n=0;n<e._verticalRepeats;n++)e.renderNineImageRow(e._image,t,i,e._centralHeight),i+=e._centralHeight;e._lastHeight>0&&(e.renderNineImageRow(e._image,t,i,e._lastHeight),i+=e._lastHeight),t+=e._centralHeight,e._bottomHeight>0&&e.renderNineImageRow(e._image,t,i,e._bottomHeight)},e.renderNineImageRow=function(t,i,n,o){var a=e._frame.x,s=0;e._leftWidth>0&&(e._nineImage.copy(t,a,i,e._leftWidth,o,s,n),s+=e._leftWidth,a+=e._leftWidth);for(var r=0;r<e._horizontalRepeats;r++)e._nineImage.copy(t,a,i,e._centralWidth,o,s,n),s+=e._centralWidth;e._lastWidth>0&&(e._nineImage.copy(t,a,i,e._lastWidth,o,s,n),s+=e._lastWidth),a+=e._centralWidth,e._rightWidth>0&&e._nineImage.copy(t,a,i,e._rightWidth,o,s,n)},e._textureKey=0,e}();e.NineImage=t}(Helper||(Helper={}));var Helper;!function(e){var t;!function(e){e[e.UNDEFINED=-1]="UNDEFINED",e[e.SPACE=1]="SPACE",e[e.NEWLINE=2]="NEWLINE",e[e.CHARACTER=3]="CHARACTER"}(t||(t={}));var i=function(){function e(){}return e.hasNext=function(){return e.textPosition<e.text.length},e.getChar=function(){return e.text.charAt(e.textPosition++)},e.peekChar=function(){return e.text.charAt(e.textPosition)},e.getPosition=function(){return e.textPosition},e.setPosition=function(t){e.textPosition=t},e.getCharAdvance=function(t,i){var n=e.fontData.chars[t],o=n.xAdvance;return i>0&&n.kerning[i]&&(o+=n.kerning[i]),o},e.getCharType=function(e){return" "===e?t.SPACE:/(?:\r\n|\r|\n)/.test(e)?t.NEWLINE:t.CHARACTER},e.wrapText=function(i,n,o,a,s,r){e.text=n,e.setPosition(0),e.fontData=i.cache.getBitmapFont(s).font,void 0===r&&(r=e.fontData.size);var l=r/e.fontData.size,h=e.fontData.lineHeight*l,c=o/l,u=[],_=[],p=[],m=0,d=!0,f=0,y=0;u[m]=y,p[f++]=0;for(var g=a;e.hasNext();){for(var E=0,S=0,v=-1,T=t.UNDEFINED,P=t.UNDEFINED,A=c,M=-1;e.hasNext();){y=e.getPosition();var C=e.getChar();T=e.getCharType(C);var L=C.charCodeAt(0);if(T===t.SPACE)P!==t.SPACE&&(S=E),++E,A-=e.getCharAdvance(L,M);else if(T===t.CHARACTER){if(P!==t.CHARACTER&&(v=y),A-=e.getCharAdvance(L,M),0>A)break;++E}else if(T===t.NEWLINE){var I=!1;if(e.hasNext()&&(I=!0,S=E,v=e.getPosition(),y=v,A=-1,T=t.CHARACTER),I)break}P=T,M=L}g-=h,0>g&&(p[f++]=m),0>A&&T===t.CHARACTER?(0!==S?_[m]=S:_[m]=E,d=!1,0>g&&(d=!0,g=a-h),0!==S?(u[++m]=v,e.setPosition(v)):(u[++m]=y,e.setPosition(y))):e.hasNext()||(T===t.CHARACTER?_[m]=E:T===t.SPACE&&(_[m]=S))}p[f]=m+1;for(var G=[],O=1;f>=O;O++){for(var k=p[O-1],N=p[O],R=[],w=k;N>w;w++)R.push(e.text.substr(u[w],_[w]));G.push(R.join("\n"))}return G},e}();e.TextWrapper=i}(Helper||(Helper={}));var Log;!function(e){var t=function(){function e(){}return e.msg=function(t){e.messages.push(t)},e.messages=[],e}();e.Log=t}(Log||(Log={}));var Meteoric;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new e.Pool(e.Block,e.Gameplay.ROWS*e.Gameplay.COLUMNS)),t._instance},enumerable:!0,configurable:!0}),t._instance=null,t}();e.BlockPool=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new e.Pool(e.BlockSprite,e.Gameplay.ROWS*e.Gameplay.COLUMNS,function(){return new e.BlockSprite(e.Global.game)})),t._instance},enumerable:!0,configurable:!0}),t._instance=null,t}();e.BlockSpritePool=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){!function(e){e[e.DEBRIS=0]="DEBRIS",e[e.ASTEROID=1]="ASTEROID",e[e.PLANET=2]="PLANET",e[e.SUN=3]="SUN",e[e.SPACESHIP=4]="SPACESHIP",e[e.BLACKHOLE=5]="BLACKHOLE"}(e.eBlockType||(e.eBlockType={}));var t=e.eBlockType,i=function(){function e(){}return e.prototype.set=function(e,t,i,n){this.x=e,this.y=t,this.value=i,this.type=n},e.prototype.clear=function(){this.x=this.y=this.value=-1,this.clearMatchCount(),this.clearFall(),this.clearMerged()},e.prototype.clearMerged=function(){this.merging=!1},e.prototype.clearMatchCount=function(){this.matchCount=0},e.prototype.clearFall=function(){this.falling=!1},Object.defineProperty(e.prototype,"isBasic",{get:function(){return this.type<=t.SUN},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.value===e.value&&this.type===e.type},e}();e.Block=i}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function t(){}return t.KEY_DELAY_FIRST=.35,t.KEY_DELAY=.1,t.TITLES=["Streak!","Amazing!","Spacetacular!"],t.PLANETS_ASSETS_COUNT=6,t.PLANETS_COUNT=4,t.SPAWN_FROM_ITEM=e.eBlockType.DEBRIS,t.SPAWN_TO_ITEM=e.eBlockType.ASTEROID,t.PLANET_COUNT_STEP_1=20,t.PLANET_COUNT_STEP_2=40,t.MATCH_LENGTH=2,t.MAX_SCORE_STREAK=5,t.FALL_DELAY=2,t.FALL_SPEED=1,t.FAST_FALL_MULTIPLIER=10,t.PLANET_FALL_MULTIPLIER=20,t.COLUMNS=8,t.ROWS=8,t.MERGE_TIME=.25,t.RISE_TIME=.5,t.SUN_EXPLODE_TIME=1,t.BLACKHOLE_MERGE_TIME=1,t.MINIMAL_OBJECTS_COUNT=16,t.INITIAL_ROWS=4,t.SKIP_PROBABILITY=.05,t.SKIP_PROBABILITY_STEP=.08,t.INIT_FROM_ITEM=t.SPAWN_FROM_ITEM,t.INIT_TO_ITEM=e.eBlockType.PLANET,t.SPACESHIP_FALL_ROUND_MIN=6,t.SPACESHIP_FALL_ROUND_MAX=8,t.RISE_ROUND_MIN=10,t.RISE_ROUND_MAX=10,t.BLACKHOLE_SPAWN_MIN=5,t.BLACKHOLE_SPAWN_MAX=5,t.CONSECUTIVE_MATCHES_FOR_BLACKHOLE=5,t}();e.Gameplay=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function e(e,t,i){void 0===i&&(i=null),this._newFunction=null,this._count=0,this._pool=[],this._canGrow=!0,this._maxPoolSize=0,this._classType=e,this._newFunction=i;for(var n=0;t>n;n++){var o=this.newItem();this._pool[this._count++]=o}}return e.prototype.createItem=function(){return 0===this._count?this._canGrow?this.newItem():null:this._pool[--this._count]},e.prototype.destroyItem=function(e){this._pool[this._count++]=e},Object.defineProperty(e.prototype,"newFunction",{set:function(e){this._newFunction=e},enumerable:!0,configurable:!0}),e.prototype.newItem=function(){return null!==this._newFunction?this._newFunction():new this._classType},Object.defineProperty(e.prototype,"canGrow",{set:function(e){this._canGrow=e},enumerable:!0,configurable:!0}),e}();e.Pool=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function t(e){this.maxVelocity=t.MAX_VELOCITY,this._velocity=new Phaser.Point(0,0),this._angularVelocity=0,this._friction=0,this._angularDrag=0,this._gravity=0,this._alpha=1,this._scaleChange=0,this._alphaChange=0,this._game=e}return Object.defineProperty(t.prototype,"visual",{get:function(){return this._visual},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"on",{set:function(e){this._on=e,this._visual.exists=e,this._visual.visible=e},enumerable:!0,configurable:!0}),t.prototype.remove=function(){var e=this._visual.parent;null!==e&&(e instanceof Phaser.Group?e.remove(this._visual):e.removeChild(this._visual),e=null)},t.prototype.bringToTop=function(){var e=this._visual.parent;e instanceof Phaser.Group&&e.bringToTop(this._visual)},t.prototype.sendToBack=function(){var e=this._visual.parent;e instanceof Phaser.Group&&e.sendToBack(this._visual)},Object.defineProperty(t.prototype,"textureKey",{set:function(e){this._textureKey=e},enumerable:!0,configurable:!0}),t.prototype.setScaleChange=function(e,t){void 0===t&&(t=0),this._scaleChangeType=e,this._scaleChange=t},Object.defineProperty(t.prototype,"alpha",{set:function(e){this._alpha=e,this._visual.alpha=Phaser.Math.clamp(e,0,1)},enumerable:!0,configurable:!0}),t.prototype.setAlphaChange=function(e,t){void 0===t&&(t=0),this._alphaChangeType=e,this._alphaChange=t},t.prototype.setPhysics=function(e,t,i,n,o,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===a&&(a=0),this._velocity.setTo(e,t),this._angularVelocity=i,this._friction=n,this._angularDrag=o,this._gravity=a,this._simplePhysics=0===a&&0===n&&0===o},t.prototype.setFrame=function(e){},t.prototype.onEmit=function(e){e.add(this._visual)},t.prototype.onKill=function(e){},t.prototype.update=function(t){void 0===t&&(t=!0);var i=this._game.time.physicsElapsed;if(this.lifetime>0&&(this.lifetime-=i)<=0)return!1;if((0!==this._velocity.x||0!==this._velocity.y)&&(this._visual.x+=this._velocity.x*i,this._visual.y+=this._velocity.y*i),0!==this._angularVelocity&&(this._visual.angle+=this._angularVelocity*i),this._simplePhysics||(this._velocity.x+=-this._friction*this._velocity.x*i,this._velocity.y+=(this._gravity-this._friction*this._velocity.y)*i,this._angularVelocity+=-this._angularDrag*this._angularVelocity*i),!t)return!0;if(this._scaleChangeType!=e.eParameterChangeType.NO_CHANGE)switch(this._scaleChangeType){case e.eParameterChangeType.IN_TIME:(this._visual.scale.x+=this._scaleChange*i)<0&&(this._visual.scale.x=0,this._scaleChange<0&&(this._scaleChangeType=e.eParameterChangeType.NO_CHANGE)),(this._visual.scale.y+=this._scaleChange*i)<0&&(this._visual.scale.y=0,this._scaleChange<0&&(this._scaleChangeType=e.eParameterChangeType.NO_CHANGE))}if(this._alphaChangeType!=e.eParameterChangeType.NO_CHANGE)switch(this._alphaChangeType){case e.eParameterChangeType.IN_TIME:this._alpha+=this._alphaChange*i,this._alpha<0?(this._visual.alpha=0,this._alphaChange<0&&(this._alphaChangeType=e.eParameterChangeType.NO_CHANGE)):this._alpha>1?(this._visual.alpha=1,this._alphaChange>0&&(this._alphaChangeType=e.eParameterChangeType.NO_CHANGE)):this._visual.alpha=this._alpha}return!0},t.MAX_VELOCITY=1e3,t}();e.Particle=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t;!function(e){e[e.FLOW=0]="FLOW",e[e.EXPLODE=1]="EXPLODE"}(t||(t={})),function(e){e[e.NO_CHANGE=0]="NO_CHANGE",e[e.IN_TIME=1]="IN_TIME"}(e.eParameterChangeType||(e.eParameterChangeType={}));var i=e.eParameterChangeType,n=function(n){function o(a,s,r,l){n.call(this,a,null),this._maxParticles=o.MAX_PARTICELES,this.emitPoint=new Phaser.Point(0,0),this.area=new Phaser.Point(0,0),this.gravity=100,this.particleClass=e.SpriteParticle,this.particleBringToTop=!1,this.particleSendToBack=!1,this.frequency=100,this.minLifetime=1,this.maxLifetime=2,this.minParticleScale=1,this.maxParticleScale=1,this.scaleChange=0,this.scaleChangeType=i.NO_CHANGE,this.minParticleSpeed=new Phaser.Point(-100,-100),this.maxParticleSpeed=new Phaser.Point(100,100),this.particleFriction=0,this.minAngularSpeed=-360,this.maxAngularSpeed=360,this.angularDrag=0,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaChange=0,this.alphaChangeType=i.NO_CHANGE,this.forceEmit=!1,this._on=!1,this._mode=t.FLOW,this._flowQuantity=0,this._flowTotal=0,this._flowCounter=0,this._particlesPool=[],this._counterPool=0,this._particlesUsed=[],this._counterUsed=0,this._timer=0,this._frames=null,this._emitPoint=new Phaser.Point(0,0),this._minParticleScale=new Phaser.Point(1,1),this._maxParticleScale=new Phaser.Point(1,1),this.position.setTo(s,r),this._maxParticles=l}return __extends(o,n),o.prototype.update=function(){if(this._on&&this.game.time.time>=this._timer&&(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,this._mode===t.FLOW))if(-1!==this._flowTotal&&this._flowCounter>=this._flowTotal)this.on=!1;else for(var e=Math.max(1,this._flowQuantity),i=0;e>i&&!(this.emitParticle(this.forceEmit)&&(this._flowCounter++,-1!==this._flowTotal&&this._flowCounter>=this._flowTotal));i++);for(var i=this._counterUsed-1;i>=0;i--){var n=this._particlesUsed[i];n.update()||(n.on=!1,n.remove(),n.onKill(this),this._particlesUsed[i]=this._particlesUsed[--this._counterUsed],this._particlesPool[this._counterPool++]=n)}},o.prototype.makeParticles=function(e,t,i){(void 0===i||i>this._maxParticles)&&(i=this._maxParticles),void 0!==t&&(this._frames=t);for(var n=0;i>n;n++){var o=new this.particleClass(this.game);o.textureKey=e,o.onCreate(this),o.on=!1,this._particlesPool[this._counterPool++]=o}},Object.defineProperty(o.prototype,"on",{set:function(e){this._on=e,this.exists=e,this.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"lifetime",{set:function(e){this.minLifetime=this.maxLifetime=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"count",{get:function(){return this._counterUsed},enumerable:!0,configurable:!0}),o.prototype.explode=function(e,i,n){this._mode=t.EXPLODE,this.on=!0,this.emitParticles(e,i,n)},o.prototype.flow=function(e,i,n,o,a,s){this._mode=t.FLOW,this.on=!0,(void 0===i||0===i)&&(i=1),void 0===n&&(n=-1),void 0===o&&(o=!0),i>this._maxParticles&&(i=this._maxParticles),this.frequency=e,this._flowCounter=0,this._flowQuantity=i,this._flowTotal=n,o&&(this.emitParticles(i,a,s),this._flowCounter+=i,this._timer=this.game.time.time+e*this.game.time.slowMotion)},o.prototype.killAllParticles=function(e){for(void 0===e&&(e=!0);this._counterUsed>0;){var t=this._particlesUsed[--this._counterUsed];t.remove(),e||t.onKill(this),this._particlesPool[this._counterPool++]=t}},o.prototype.emitParticles=function(e,t,i){for(var n=0;e>n;n++){var o=this.emitParticle(this.forceEmit);if(null===o)break;void 0!==t&&null!==t&&t.call(i,o)}},o.prototype.emitParticle=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),0===this._counterPool){if(!e)return null;var n=this._particlesUsed[0];this._particlesUsed[0]=this._particlesUsed[--this._counterUsed],n.remove(),n.onKill(this),this._particlesPool[this._counterPool++]=n}var o=this._particlesPool[--this._counterPool];if(this._particlesUsed[this._counterUsed++]=o,o.on=!0,this.randomEmitPoint(this._emitPoint),o.visual.position.set(this._emitPoint.x,this._emitPoint.y),o.visual.angle=0,t)o.lifetime=-1,o.visual.scale.set(1,1),o.setScaleChange(i.NO_CHANGE),o.alpha=1,o.setAlphaChange(i.NO_CHANGE),o.setPhysics();else{if(o.lifetime=this.game.rnd.realInRange(this.minLifetime,this.maxLifetime),1!==this.minParticleScale||1!==this.maxParticleScale){var a=this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale);o.visual.scale.set(a,a)}else this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y?o.visual.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)):o.visual.scale.set(1,1);o.setScaleChange(this.scaleChangeType,this.scaleChange),o.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),o.setAlphaChange(this.alphaChangeType,this.alphaChange),o.setPhysics(this.game.rnd.realInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x),this.game.rnd.realInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y),this.game.rnd.realInRange(this.minAngularSpeed,this.maxAngularSpeed),this.particleFriction,this.angularDrag,this.gravity),null!==this._frames&&o.setFrame(this.randomFrame())}return o.onEmit(this),this.particleBringToTop?o.bringToTop():this.particleSendToBack&&o.sendToBack(),o},o.prototype.destroy=function(){e.ParticlesManager.instance.remove(this),n.prototype.destroy.call(this,!0,!1)},o.prototype.randomFrame=function(){var e=null;return null!==this._frames&&(e=Array.isArray(this._frames)?"string"==typeof this._frames[0]?this.game.rnd.pick(this._frames):this.game.rnd.pick(this._frames):this._frames),e},o.prototype.randomEmitPoint=function(e){return this.area instanceof Phaser.Point?e.setTo(0,0):this.area.random(e),e.x+=this.emitPoint.x,e.y+=this.emitPoint.y,e},o.prototype.setXSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.x=e,this.maxParticleSpeed.x=t},o.prototype.setYSpeed=function(e,t){e=e||0,t=t||0,this.minParticleSpeed.y=e,this.maxParticleSpeed.y=t},o.prototype.setAngularSpeed=function(e,t){e=e||0,t=t||0,this.minAngularSpeed=e,this.maxAngularSpeed=t},o.prototype.setAlpha=function(e,t){void 0===e&&(e=1),void 0===t&&(t=1),this.minParticleAlpha=e,this.maxParticleAlpha=t},o.prototype.setAlphaChange=function(e,t,n){switch(void 0===t&&(t=0),void 0===n&&(n=0),this.alphaChangeType=e,e){case i.NO_CHANGE:this.alphaChange=0;break;case i.IN_TIME:0===n&&(n=1),this.alphaChange=t/n}},o.prototype.setScale=function(e,t,i,n){void 0===e&&(e=1),void 0===t&&(t=1),void 0===i&&(i=1),void 0===n&&(n=1),this._minParticleScale.setTo(e,i),this._maxParticleScale.setTo(t,n)},o.prototype.setScaleChange=function(e,t,n){switch(void 0===t&&(t=0),void 0===n&&(n=0),this.scaleChangeType=e,e){case i.NO_CHANGE:this.scaleChange=0;break;case i.IN_TIME:0===n&&(n=1),this.scaleChange=t/n}},o.prototype.emitAt=function(e,t){this.emitPoint.setTo(e,t)},o.prototype.emitAtObject=function(e){e.center?this.emitPoint.setTo(e.center.x,e.center.y):this.emitPoint.setTo(e.x,e.y)},o.MAX_PARTICELES=16,o}(Phaser.Group);e.ParticlesEmitter=n}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function e(){this._emitters=[],this._emittersCount=0}return Object.defineProperty(e,"instance",{get:function(){return null===e._instance&&(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._emitters[this._emittersCount++]=e},e.prototype.remove=function(e){for(var t=this._emittersCount-1;t>=0&&this._emitters[t]!==e;t--);-1!==t&&(this._emitters[t]=this._emitters[--this._emittersCount])},e.prototype.update=function(){for(var e=0;e<this._emittersCount;e++){var t=this._emitters[e];t.exists&&t.update()}},e._instance=null,e}();e.ParticlesManager=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.setFrame=function(e){var t=this._visual;"string"==typeof e?t.frameName=e:t.frame=e},t.prototype.onCreate=function(e){var t=new Phaser.Sprite(this._game,0,0,this._textureKey);t.anchor.setTo(.5,.5),this._visual=t},t}(e.Particle);e.SpriteParticle=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.onCreate=function(n){t.prototype.onCreate.call(this,n);var o=this._visual,a=10/e.Gameplay.SUN_EXPLODE_TIME;o.animations.add("explosion",i.EXPLOSION,a,!1),a=7/e.Gameplay.BLACKHOLE_MERGE_TIME,o.animations.add("blackhole",i.BLACK_HOLE,a,!1)},i.prototype.onEmit=function(e){t.prototype.onEmit.call(this,e);var i=this._visual;i.animations.currentAnim.stop()},i.EXPLOSION=Phaser.Animation.generateFrameNames("explosion0",0,9),i.BLACK_HOLE=Phaser.Animation.generateFrameNames("bh_anim0",1,7),i}(e.SpriteParticle);e.AnimatedParticle=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function e(){this.blocks=[],this.length=0,this.consecutiveMatch=0}return e.prototype.clear=function(){this.length=0},e.prototype.add=function(e){this.blocks[this.length++]=e},e}();e.BlockChain=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(t){function i(n){t.call(this,n,0,0,"Sprites"),this.anchor.set(.5,.5),this._over=new Phaser.Sprite(n,0,0,"Sprites"),this._over.anchor.set(.5,.5),this._over.kill(),this._under=new Phaser.Sprite(n,0,0,"Sprites"),this._under.anchor.set(.5,.5),this._under.kill(),this._fallTween1=n.add.tween(this.scale).to({x:1.15},i.TWEEN_TIME,e.Easing.halfSin,!1),this._fallTween2=n.add.tween(this.scale).to({y:.9},i.TWEEN_TIME,e.Easing.halfSin,!1)}return __extends(i,t),Object.defineProperty(i.prototype,"block",{get:function(){return this._block},set:function(e){this._block=e},enumerable:!0,configurable:!0}),i.prototype.setVisual=function(t){var i=this._block,n=e.BlockTypes.types[i.value];this.scale.set(1,1),this._under.scale.set(1,1),this._over.scale.set(1,1),i.type<=e.eBlockType.PLANET?(this.frameName=e.BlockTypes.SPRITE_DEFS[i.type][n],i===t.board.currentBlock&&(this._under.exists=this._under.visible=!0,this._under.frameName=i.type===e.eBlockType.DEBRIS?"ohon_bordelu":"ohon_asteroidu",this._under.anchor.set(.5,.9),t.underGroup.add(this._under))):i.type===e.eBlockType.SUN?(this.frameName=e.BlockTypes.SUN,this._over.exists=this._over.visible=!0,this._over.frameName="slunecni_zare",t.overGroup.add(this._over),t.underGroup.remove(this._under),this._under.kill()):i.type===e.eBlockType.SPACESHIP?this.frameName=e.BlockTypes.SPACESHIP_TYPES[i.value]:i.type===e.eBlockType.BLACKHOLE&&(this.frameName=e.BlockTypes.BLACKHOLE_TYPES[0])},i.prototype.onSpawned=function(e){e.add(this)},i.prototype.onDestroy=function(e){e.remove(this),e.underGroup.remove(this._under),e.overGroup.remove(this._over),this._under.kill(),this._over.kill()},i.prototype.updateBlock=function(t){var i=this._block.x*e.Gameplay.BLOCK_WIDTH+e.Gameplay.BLOCK_WIDTH/2,n=-this._block.y*e.Gameplay.BLOCK_HEIGHT-e.Gameplay.BLOCK_HEIGHT/2;if(this.position.set(i,n),this._under.position.set(i,n),this._over.position.set(i,n),this._block.type===e.eBlockType.SUN){var o=t.board.sunshineCounter,a=1-.1*o;this._over.scale.set(a,a)}if(this._under.exists&&this._block!==t.board.currentBlock&&(t.underGroup.remove(this._under),this._under.kill()),this._block.merging&&t.board.state===e.eBoardState.BLACKHOLE_MERGE){var a=1-.6*t.board.mergeRatio;this.scale.set(a,a),this._over.scale.set(a,a)}},i.prototype.fallTween=function(){this._fallTween1.isRunning||(this._fallTween1.start(),this._fallTween2.start())},i.TWEEN_TIME=200,i}(Phaser.Sprite);e.BlockSprite=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function t(){}return t.randomize=function(){for(var i=[],n=0;n<e.Gameplay.PLANETS_ASSETS_COUNT;n++)i[n]=n;t.types=Helper.ArrayUtils.randomizeArray(e.Gameplay.PLANETS_ASSETS_COUNT,i)},t.DEBRIS_TYPES=["bordel_A","bordel_B","bordel_C","bordel_D","bordel_E","bordel_F"],t.ASTEROID_TYPES=["asteroid_A","asteroid_B","asteroid_C","asteroid_D","asteroid_E","asteroid_F"],t.PLANET_TYPES=["planeta_A","planeta_B","planeta_C","planeta_D","planeta_E","planeta_F"],t.SUN="slunce",t.SPACESHIP_TYPES=["satelit","sputnik","ufo"],t.BLACKHOLE_TYPES=["cerna_dira"],t.SPRITE_DEFS=[t.DEBRIS_TYPES,t.ASTEROID_TYPES,t.PLANET_TYPES,t.SUN,t.SPACESHIP_TYPES,t.BLACKHOLE_TYPES],t}();e.BlockTypes=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){!function(e){e[e.NONE=0]="NONE",e[e.SPAWN=1]="SPAWN",e[e.FALL_DELAY=2]="FALL_DELAY",e[e.FALLING=3]="FALLING",e[e.MATCH=4]="MATCH",e[e.MERGE=5]="MERGE",e[e.RISE=6]="RISE",e[e.RISE_WAIT=7]="RISE_WAIT",e[e.SUN_EXPLODE_WAIT=8]="SUN_EXPLODE_WAIT",e[e.BLACKHOLE_MERGE=9]="BLACKHOLE_MERGE"}(e.eBoardState||(e.eBoardState={}));var t=e.eBoardState,i=function(){function i(e,t){this._foundChains=[],this._mergeBlocks=[],this._sunsToExplode=[],this._game=e,this._listener=t,this._blocks=this.createEmptyBoard()}return Object.defineProperty(i.prototype,"currentBlock",{get:function(){return this._currentBlock},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mergeRatio",{get:function(){return this._mergeRatio},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sunshineCounter",{get:function(){return this._sunshineCounter},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fastFall",{set:function(e){this._fastFall=e,e&&(this._fallDelayCounter=0)},enumerable:!0,configurable:!0}),i.prototype.moveBlock=function(t){if(0!==t&&null!==this._currentBlock){var i=Math.floor(this._currentBlock.x),n=i+t;if(!(0>n||n>=e.Gameplay.COLUMNS)){var o=Math.floor(this._currentBlock.y);null===this._blocks[o][n]&&(this._blocks[o][i]=null,this._blocks[o][n]=this._currentBlock,this._currentBlock.x=n),this._fallDelayCounter=0}}},i.prototype.reset=function(){for(var i=0;i<e.Gameplay.ROWS+1;i++)for(var n=0;n<e.Gameplay.COLUMNS;n++)null!==this._blocks[i][n]&&(e.BlockPool.instance.destroyItem(this._blocks[i][n]),this._blocks[i][n]=null);this._currentBlock=null,this._fallSpeed=e.Gameplay.FALL_SPEED,this._spaceshipRoundCounter=this._game.rnd.integerInRange(e.Gameplay.SPACESHIP_FALL_ROUND_MIN,e.Gameplay.SPACESHIP_FALL_ROUND_MAX),this._riseRoundCounter=this._game.rnd.integerInRange(e.Gameplay.RISE_ROUND_MIN,e.Gameplay.RISE_ROUND_MAX),this._blackholeCounter=e.Gameplay.CONSECUTIVE_MATCHES_FOR_BLACKHOLE,this._planetsCount=e.Gameplay.PLANETS_COUNT,this.spawnRows(e.Gameplay.INITIAL_ROWS,!0),this._state=t.SPAWN,this._spawnCounter=0,this._consecutiveMatches=0},i.prototype.update=function(){switch(this.updateSunshine(),this._state){case t.SPAWN:this.fastFall=!1,this.spawnBlock(),null!==this._currentBlock?(this._state=t.FALL_DELAY,this._fallDelayCounter=e.Gameplay.FALL_DELAY):this._state=t.FALLING;
break;case t.FALL_DELAY:this._fallDelayCounter-=this._game.time.physicsElapsed,this._fallDelayCounter<=0&&(this._state=t.FALLING);break;case t.FALLING:var i=t.NONE;(i=this.fall(this._fallSpeed))!==t.NONE&&(this._state=i);break;case t.BLACKHOLE_MERGE:this.updateMerge(this._game.time.physicsElapsed)&&(this.destroyMerged(),this._state=t.FALLING);break;case t.MATCH:this._currentBlock=null;var n=this.findGroups();0===n?(this._userObjectFalling&&(this._consecutiveMatches=0,this._blackholeCounter=e.Gameplay.CONSECUTIVE_MATCHES_FOR_BLACKHOLE),this._riseRoundCounter<=0||this.objectsCount()<e.Gameplay.MINIMAL_OBJECTS_COUNT?(this._waitCounter=e.Gameplay.RISE_TIME,this.initRise(),this._state=t.RISE_WAIT):this._state=t.SPAWN):(--this._blackholeCounter,this.removeChains()?(this._mergeTime=0,this._mergeRatio=0,this._state=t.MERGE):this._state=t.FALLING),this.clearFall();break;case t.MERGE:this.updateMerge(this._game.time.physicsElapsed)&&(this.destroyMerged(),this._waitCounter<=0?this._state=t.FALLING:this._state=t.SUN_EXPLODE_WAIT);break;case t.SUN_EXPLODE_WAIT:(this._waitCounter-=this._game.time.physicsElapsed)<=0&&(this._state=t.FALLING);break;case t.RISE_WAIT:(this._waitCounter-=this._game.time.physicsElapsed)<=0&&(this._state=t.RISE);break;case t.RISE:this.rise(this._game.time.physicsElapsed)||(this._gameOverAfterRise?(this._state=t.NONE,this._listener.onGameOver(null)):this._state=t.SPAWN)}},i.prototype.objectsCount=function(){for(var t=0,i=0;i<e.Gameplay.ROWS;i++)for(var n=0;n<e.Gameplay.COLUMNS;n++)null!==this._blocks[i][n]&&++t;return t},i.prototype.updateSunshine=function(){var e=this._game.time.time%i.SUNSHINE_SPEED/i.SUNSHINE_SPEED;this._sunshineCounter=Math.sin(Math.PI*e)},i.prototype.initRise=function(){this._gameOverAfterRise=!1,this._riseTimeCounter=e.Gameplay.RISE_TIME,this._riseRoundCounter=this._game.rnd.integerInRange(e.Gameplay.RISE_ROUND_MIN,e.Gameplay.RISE_ROUND_MAX);for(var t=e.Gameplay.ROWS-1,i=t;i>=0;i--)for(var n=0;n<e.Gameplay.COLUMNS;n++){var o=this._blocks[i][n];this._blocks[i+1][n]=o,this._blocks[i][n]=null,i===t&&null!==o&&(this._gameOverAfterRise=!0)}this.spawnRows(1,!1),this.rise(0),this._listener.onBoardRise()},i.prototype.rise=function(t){var i=0,n=this._gameOverAfterRise?.4:0;this._riseTimeCounter-=t,i=this._riseTimeCounter>n?this._riseTimeCounter/e.Gameplay.RISE_TIME:n;for(var o=e.Gameplay.ROWS,a=o;a>=0;a--)for(var s=0;s<e.Gameplay.COLUMNS;s++){var r=this._blocks[a][s];null!==r&&(r.y=a-i)}return i>n},i.prototype.fall=function(i){var n=i*this._game.time.physicsElapsed,o=!1,a=!1,s=null;this._userObjectFalling=!1;for(var r=0;r<e.Gameplay.ROWS;r++)for(var l=0;l<e.Gameplay.COLUMNS;l++){var h=this._blocks[r][l];if(null!==h){this._blocks[r][l]=null;var c=h.y;this._currentBlock===h?this._fastFall?h.y-=n*e.Gameplay.FAST_FALL_MULTIPLIER:h.y-=n:h.y-=n*e.Gameplay.PLANET_FALL_MULTIPLIER;var u=Math.floor(h.y);(0>u||null!==this._blocks[u][l])&&(u+=1,h.y=u),this._blocks[u][l]=h,h.y!==c?(o=!0,h.falling=!0):(h.falling&&(this._listener.onFallEnded(h),h.type===e.eBlockType.SPACESHIP?Utils.AudioUtils.playSound("TrashImpact"):Utils.AudioUtils.playSound("Impact")),h===this._currentBlock&&(h.type===e.eBlockType.BLACKHOLE?(a=!0,s=h):this._userObjectFalling=!0,this._currentBlock=null))}}return a&&null!==s&&this.explodeBlackhole(s),o?t.NONE:a?t.BLACKHOLE_MERGE:t.MATCH},i.prototype.updateMerge=function(i){var n=!1;this._mergeTime+=i,this._mergeTime>this._mergingTimeMax?(this._mergeTime=this._mergingTimeMax,this._mergeRatio=1,n=!0):this._mergeRatio=this._mergeTime/this._mergingTimeMax,this._state===t.BLACKHOLE_MERGE&&(this._mergeRatio=this._mergeRatio*this._mergeRatio,this._mergeRatio=this._mergeRatio*this._mergeRatio);for(var o=0;o<this._mergeBlocksCount;o++)this._mergeBlocks[o].update(this._mergeRatio);if(n){this._sunsToExplodeCount>0?this._waitCounter=e.Gameplay.SUN_EXPLODE_TIME:this._waitCounter=0;for(var o=0;o<this._sunsToExplodeCount;o++){var a=this._sunsToExplode[o];this._listener.onExplodeSun(a),this.explodeSun(a)}}return n},i.prototype.destroyMerged=function(){for(var e=0;e<this._mergeBlocksCount;e++)if(this._mergeBlocks[e].destroyOnFinish){var t=this._mergeBlocks[e].block;this.destroyBlock(t)}},i.prototype.iterateBlocks=function(t){for(var i=0;i<e.Gameplay.ROWS;i++)for(var n=0;n<e.Gameplay.COLUMNS;n++){var o=this._blocks[i][n];null!==o&&t(o)}},i.prototype.clearMatched=function(){this.iterateBlocks(function(e){e.clearMerged()})},i.prototype.clearMatchCount=function(){this.iterateBlocks(function(e){e.clearMatchCount()})},i.prototype.clearFall=function(){this.iterateBlocks(function(e){e.clearFall()})},i.prototype.findGroups=function(){this._foundChainsCount=0,this.clearMatchCount();for(var t=this.getFreeChain(),i=0;i<e.Gameplay.ROWS;i++)for(var n=0;n<e.Gameplay.COLUMNS;n++){var o=this._blocks[i][n];if(null!==o&&o.isBasic&&0===o.matchCount)if(this.findGroupRecursively(n,i,o,t)>=e.Gameplay.MATCH_LENGTH){++this._consecutiveMatches;var a=this._consecutiveMatches;t.consecutiveMatch=a>=3?a:0;var s=10;o.type===e.eBlockType.PLANET?s=20:o.type===e.eBlockType.SUN&&(s=30),s*=Math.min(this._consecutiveMatches,e.Gameplay.MAX_SCORE_STREAK),this._listener.onAddScore(s),t=this.getFreeChain()}else t.clear()}return t.length<e.Gameplay.MATCH_LENGTH&&--this._foundChainsCount,this._foundChainsCount},i.prototype.findGroupRecursively=function(t,i,n,o){if(0>t||t>=e.Gameplay.COLUMNS||0>i||i>=e.Gameplay.ROWS)return o.length;var a=this._blocks[i][t];return null!==a&&0===a.matchCount&&a.equals(n)&&(o.add(a),a.matchCount=1,this.findGroupRecursively(t-1,i,a,o),this.findGroupRecursively(t+1,i,a,o),this.findGroupRecursively(t,i-1,a,o),this.findGroupRecursively(t,i+1,a,o)),o.length},i.prototype.getFreeChain=function(){this._foundChainsCount>=this._foundChains.length&&(this._foundChains[this._foundChainsCount]=new e.BlockChain);var t=this._foundChains[this._foundChainsCount++];return t.clear(),t},i.prototype.removeChains=function(){this._mergingTimeMax=e.Gameplay.MERGE_TIME,this.clearMatched();var t=!1;this._mergeBlocksCount=0,this._sunsToExplodeCount=0;for(var i=0;i<this._foundChainsCount;i++){var n=this._foundChains[i],o=this.getChainMainBlock(n),a=n.consecutiveMatch;(3===a||5===a||7===a)&&(this._listener.onStreakTitle(a),7>a?Utils.AudioUtils.playSound("SmallCheer"):Utils.AudioUtils.playSound("BigCheer")),a>=3&&this._listener.onStreak(o,a);for(var s=0;s<n.length;s++){var r=n.blocks[s];r.type===e.eBlockType.ASTEROID?Utils.AudioUtils.playSound("MatchAsteroid"):r.type===e.eBlockType.PLANET?Utils.AudioUtils.playSound("MatchPlanet"):r.type===e.eBlockType.SUN&&Utils.AudioUtils.playSound("MatchSun"),this.explodeSpaceships(r),r!==o?(r.mainBlock=!1,this._blocks[r.y][r.x]=null):r.mainBlock=!0,this.setMerger(r,o),t=!0}}return t},i.prototype.setMerger=function(t,i){this._mergeBlocksCount>=this._mergeBlocks.length&&(this._mergeBlocks[this._mergeBlocksCount]=new e.Merger(this));var n=this._mergeBlocks[this._mergeBlocksCount++];n.init(t,t!==i,t.x,t.y,i.x,i.y),t.merging=!0},i.prototype.explodeBlackhole=function(t){this._mergeRatio=0,this._mergingTimeMax=e.Gameplay.BLACKHOLE_MERGE_TIME,this.clearMatched(),this._mergeBlocksCount=0,this._sunsToExplodeCount=0;for(var i=t.x,n=t.y,o=0;o<e.Gameplay.COLUMNS;o++){var a=this._blocks[n][o];null!==a&&a!==t&&(this._blocks[n][o]=null,this.setMerger(a,t))}for(var s=0;s<e.Gameplay.ROWS;s++){var a=this._blocks[s][i];null!==a&&a!==t&&(this._blocks[s][i]=null,this.setMerger(a,t))}this._blocks[n][i]=null,this._listener.onExplodeBlackhole(t),this.destroyBlock(t)},i.prototype.explodeSpaceships=function(e){this.explodeSpaceship(e.x,e.y+1),this.explodeSpaceship(e.x-1,e.y),this.explodeSpaceship(e.x+1,e.y),this.explodeSpaceship(e.x,e.y-1)},i.prototype.explodeSpaceship=function(t,i){if(!(0>t||t>=e.Gameplay.COLUMNS||0>i||i>=e.Gameplay.ROWS)){var n=this._blocks[i][t];null!==n&&n.type===e.eBlockType.SPACESHIP&&(this._blocks[i][t]=null,this._listener.onExplodeSpaceship(n),this.destroyBlock(n))}},i.prototype.explodeSun=function(t){for(var i=t.x,n=t.y,o=n-1;n+1>=o;o++)if(!(0>o||o>=e.Gameplay.ROWS))for(var a=i-1;i+1>=a;a++)if(!(0>a||a>=e.Gameplay.COLUMNS)){var s=this._blocks[o][a];null!==s&&((a!==i||o!==n)&&this._listener.onKilledBySun(s,t),this._blocks[o][a]=null,this.destroyBlock(s))}},i.prototype.onMergeFinish=function(i){this._state==t.MERGE&&(i.type<=e.eBlockType.PLANET?(++i.type,i.value=i.type!==e.eBlockType.SUN?i.value:0):i.type===e.eBlockType.SUN&&i.mainBlock&&(this._sunsToExplode[this._sunsToExplodeCount++]=i),this._listener.onBlockMergeFinish(i))},i.prototype.getChainMainBlock=function(e){for(var t=e.blocks[0],i=0;i<e.length;i++){var n=e.blocks[i];n.falling&&(t.falling?n.y<=t.y&&(t=n):t=n)}return t},i.prototype.destroyBlock=function(t){this._listener.onBlockDestroyed(t),e.BlockPool.instance.destroyItem(t)},i.prototype.createEmptyBoard=function(){for(var t=[],i=0;i<e.Gameplay.ROWS+1;i++){for(var n=[],o=0;o<e.Gameplay.COLUMNS;o++)n[o]=null;t[i]=n}return t},i.prototype.spawnBlock=function(){var t=!1;this._blackholeCounter<=0&&(t=!0,this._blackholeCounter=e.Gameplay.CONSECUTIVE_MATCHES_FOR_BLACKHOLE);var i=!1;--this._spaceshipRoundCounter<=0&&(i=!0,this._spaceshipRoundCounter=this._game.rnd.integerInRange(e.Gameplay.SPACESHIP_FALL_ROUND_MIN,e.Gameplay.SPACESHIP_FALL_ROUND_MAX)),--this._riseRoundCounter;var n=e.BlockPool.instance.createItem();return n.clear(),t?this.spawnStandard(n,!0):i?this.spawnSpaceship(n):this.spawnStandard(n,!1),n},i.prototype.spawnStandard=function(t,i){var n=e.Gameplay.ROWS-1,o=Math.floor(e.Gameplay.COLUMNS/2);e.Gameplay.COLUMNS%2===0&&(null===this._blocks[n][o]&&null===this._blocks[n][o-1]?o+=e.Global.game.rnd.integerInRange(-1,0):null!==this._blocks[n][o]&&(o-=1)),i?t.set(o,n+.25,0,e.eBlockType.BLACKHOLE):(t.set(o,n+.25,this._game.rnd.integerInRange(0,this._planetsCount-1),this._game.rnd.integerInRange(e.Gameplay.SPAWN_FROM_ITEM,e.Gameplay.SPAWN_TO_ITEM)),++this._spawnCounter,this._planetsCount=this._spawnCounter>e.Gameplay.PLANET_COUNT_STEP_2?6:this._spawnCounter>e.Gameplay.PLANET_COUNT_STEP_1?5:4),this._currentBlock=t,this._fastFall=!1,Utils.AudioUtils.playSound("Fall"),this._listener.onBlockSpawned(t),null!==this._blocks[n][o]?this._listener.onGameOver(t):this._blocks[n][o]=t},i.prototype.spawnSpaceship=function(t){var i=e.Gameplay.ROWS-1,n=this._game.rnd.integerInRange(0,e.Gameplay.COLUMNS-1),o=n;do{if(null===this._blocks[i][n])break;n=(n+1)%e.Gameplay.COLUMNS}while(n!==o);t.set(n,i+.35,this._game.rnd.integerInRange(0,e.BlockTypes.SPACESHIP_TYPES.length-1),e.eBlockType.SPACESHIP),this._currentBlock=null,this._fastFall=!0,Utils.AudioUtils.playSound("Fall"),this._listener.onBlockSpawned(t),null!==this._blocks[i][n]?this._listener.onGameOver(t):this._blocks[i][n]=t},i.prototype.spawnRows=function(t,i){this._foundChainsCount=0;for(var n=this.getFreeChain(),o=e.Gameplay.SKIP_PROBABILITY,a=0;t>a;a++){for(var s=0;s<e.Gameplay.COLUMNS;s++)if(0===a||null!==this._blocks[a-1][s]){if(i&&this._game.rnd.frac()<o)continue;var r=e.BlockPool.instance.createItem();this._blocks[a][s]=r,r.clear(),r.set(s,a,this._game.rnd.integerInRange(0,this._planetsCount-1),this._game.rnd.integerInRange(e.Gameplay.INIT_FROM_ITEM,e.Gameplay.INIT_TO_ITEM)),this.clearMatchCount(),n.clear();for(;this.findGroupRecursively(s,a,r,n)>=e.Gameplay.MATCH_LENGTH;)this.clearMatchCount(),n.clear(),r.value=this._game.rnd.integerInRange(0,this._planetsCount-1),r.type=this._game.rnd.integerInRange(e.Gameplay.INIT_FROM_ITEM,e.Gameplay.INIT_TO_ITEM);this._listener.onBlockSpawned(r)}o+=e.Gameplay.SKIP_PROBABILITY_STEP}},i.prototype.killAll=function(t){for(var i=0;i<e.Gameplay.ROWS+1;i++)for(var n=0;n<e.Gameplay.COLUMNS;n++){var o=this._blocks[i][n];null!==o&&(e.BlockPool.instance.destroyItem(o),t.onExplodeSpaceship(o),t.onBlockDestroyed(o),this._blocks[i][n]=null)}null!==this._currentBlock&&(t.onExplodeSpaceship(this._currentBlock),t.onBlockDestroyed(this._currentBlock))},i.SUNSHINE_SPEED=2e3,i}();e.Board=i}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(t){function i(n,o){t.call(this,n,o),this._hlpPoint=new Phaser.Point,e.Gameplay.BLOCK_WIDTH=Math.floor(n.width/e.Gameplay.COLUMNS),e.Gameplay.BLOCK_HEIGHT=Math.floor(n.height/e.Gameplay.ROWS);var a=new e.ParticlesEmitter(n,0,0,i.DEBRIS_PARTICLES);a.particleClass=e.DelayedParticle,a.gravity=2e3,a.lifetime=5,a.setXSpeed(-50,50),a.setYSpeed(-400,-600),a.setAngularSpeed(-45,45),a.makeParticles("Sprites",null,i.DEBRIS_PARTICLES),this.game.world.add(a),this._debrisEmitter=a,a=new e.ParticlesEmitter(n,0,0,i.DEBRIS_PARTICLES),a.particleClass=e.AnimatedParticle,a.gravity=0,a.lifetime=.75,a.setXSpeed(0),a.setYSpeed(0),a.setAngularSpeed(0),a.makeParticles("Sprites",null,i.DEBRIS_PARTICLES),this.game.world.add(a),this._explosionEmitter=a}return __extends(i,t),Object.defineProperty(i.prototype,"board",{get:function(){return this._board},set:function(e){this._board=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"underGroup",{get:function(){return this._underGroup},set:function(e){this._underGroup=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"overGroup",{get:function(){return this._overGroup},set:function(e){this._overGroup=e},enumerable:!0,configurable:!0}),i.prototype.reset=function(){this._debrisEmitter.killAllParticles(),this._explosionEmitter.killAllParticles(),this.forEach(function(t){t.block=null,e.BlockSpritePool.instance.destroyItem(t)},this),this.removeAll()},i.prototype.update=function(){this.forEach(function(e){e.updateBlock(this)},this)},i.prototype.findBlockSprite=function(e){for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i.block===e)return i}return null},i.prototype.onBlockSpawned=function(t){var i=e.BlockSpritePool.instance.createItem();i.block=t,i.setVisual(this),i.updateBlock(this),i.onSpawned(this)},i.prototype.onBlockDestroyed=function(t){var i=this.findBlockSprite(t);i.onDestroy(this),e.BlockSpritePool.instance.destroyItem(i)},i.prototype.onBlockMergeFinish=function(e){var t=this.findBlockSprite(e);t.setVisual(this)},i.prototype.onGameOver=function(e){},i.prototype.onExplodeSpaceship=function(e){var t=this.findBlockSprite(e);this._debrisEmitter.emitAtObject(t);var i=this._debrisEmitter.emitParticle();if(null!==i){var n=t.frameName;i.setFrame(n)}},i.prototype.onExplodeSun=function(t){var i=this.findBlockSprite(t);this._explosionEmitter.emitAtObject(i);var n=this._explosionEmitter.emitParticle();null!==n&&(n.lifetime=e.Gameplay.SUN_EXPLODE_TIME,n.visual.animations.play("explosion"))},i.prototype.onKilledBySun=function(t,i){var n=this.findBlockSprite(t);this._hlpPoint.set(t.x-i.x,i.y-t.y),this._hlpPoint.setMagnitude(this.game.rnd.integerInRange(200,400));var o=n.frameName;this._debrisEmitter.emitAtObject(n);var a=this._debrisEmitter.emitParticle();null!==a&&(a.setFrame(o),a.setPhysics(this._hlpPoint.x,this._hlpPoint.y,this.game.rnd.integerInRange(-45,45),0,0,2e3),a.delay=e.Gameplay.SUN_EXPLODE_TIME/2)},i.prototype.onExplodeBlackhole=function(t){var i=this.findBlockSprite(t);this._explosionEmitter.emitAtObject(i);var n=this._explosionEmitter.emitParticle();null!==n&&(n.lifetime=e.Gameplay.BLACKHOLE_MERGE_TIME,n.visual.animations.play("blackhole"))},i.prototype.onFallEnded=function(e){var t=this.findBlockSprite(e);null!==t&&t.fallTween()},i.DEBRIS_PARTICLES=80,i.EXPLOSION_PARTICLES=8,i}(Phaser.Group);e.BoardGroup=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),Object.defineProperty(t.prototype,"delay",{set:function(e){this._delay=e},enumerable:!0,configurable:!0}),t.prototype.update=function(t){return void 0===t&&(t=!0),this._delay>0&&(this._delay-=this._game.time.physicsElapsed)>0?!0:e.prototype.update.call(this,t)},t.prototype.onEmit=function(t){e.prototype.onEmit.call(this,t),this._delay=0},t}(e.SpriteParticle);e.DelayedParticle=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(){function e(e){this._listener=e}return e.prototype.init=function(e,t,i,n,o,a){this._block=e,this._destroyOnFinish=t,this._fromX=i,this._fromY=n,this._toX=o,this._toY=a,this._time=0},Object.defineProperty(e.prototype,"block",{get:function(){return this._block},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"destroyOnFinish",{get:function(){return this._destroyOnFinish},enumerable:!0,configurable:!0}),e.prototype.update=function(e){1>e?(this._block.x=Phaser.Math.linear(this._fromX,this._toX,e),this._block.y=Phaser.Math.linear(this._fromY,this._toY,e)):(this._block.x=this._toX,this._block.y=this._toY,this._listener.onMergeFinish(this._block))},e}();e.Merger=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(e){function t(i,n){e.call(this,i,0,0,"Font","",40),this.onFinished=new Phaser.Signal,this.anchor.set(.5,.5),this.pivot.set(0,10);var o=this;this._tweenScale=i.add.tween(this.scale).to({x:2,y:2},t.TWEEN_TIME,Phaser.Easing.Linear.None,!1,t.TWEEN_DELAY),this._tweenAlpha=i.add.tween(this).to({alpha:0},t.TWEEN_TIME,Phaser.Easing.Linear.None,!1,t.TWEEN_DELAY),this._tweenAlpha.onComplete.add(function(){o.onFinished.dispatch(o)},this)}return __extends(t,e),t.prototype.tween=function(){this._tweenAlpha.isRunning||(this.scale.set(1,1),this.alpha=1,this._tweenScale.start(),this._tweenAlpha.start())},t.TWEEN_DELAY=600,t.TWEEN_TIME=300,t}(Phaser.BitmapText);e.Streak=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(t){function i(n,o){t.call(this,n,o);var a=this;this._streakPool=new e.Pool(e.Streak,i.STREAK_MAX,function(){var t=new e.Streak(n,"Font");return t.onFinished.add(a.onStreakEnd,a),t}),this._streakTitle=new e.Title(n,"Font"),this._streakTitle.position.set(n.width/2,.82*-n.height)}return __extends(i,t),i.prototype.update=function(){var e=40*this.game.time.physicsElapsed;this.forEach(function(t){t!==this._streakTitle&&(t.y-=e)},this)},i.prototype.reset=function(){this.forEach(function(e){e!==this._streakTitle&&this._streakPool.destroyItem(e)},this),this.removeAll()},i.prototype.addStreak=function(e,t,i){var n=this._streakPool.createItem();null!==n&&(n.position.set(e,t),n.text="x"+i,this.add(n),n.tween())},i.prototype.removeStreak=function(e){this._streakPool.destroyItem(e),this.remove(e)},i.prototype.onStreakEnd=function(e){this.removeStreak(e)},i.prototype.showTitle=function(t){this.add(this._streakTitle);var i="NO TITLE!";3===t?i=e.Gameplay.TITLES[0]:5===t?i=e.Gameplay.TITLES[1]:7===t&&(i=e.Gameplay.TITLES[2]),this._streakTitle.text=i,this._streakTitle.tween()},i.STREAK_MAX=4,i}(Phaser.Group);e.StreakGroup=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(e){function t(i,n){e.call(this,i,0,0,"Font","",80),this.anchor.set(.5,.5),this.pivot.set(0,-25);this._tweenScale=i.add.tween(this.scale).to({x:1,y:1},t.TWEEN_TIME,Phaser.Easing.Bounce.Out,!1),this._tweenAlpha=i.add.tween(this).to({alpha:1},t.TWEEN_TIME+200,Phaser.Easing.Linear.None,!1),this._tweenAlpha2=i.add.tween(this).to({alpha:0},400,Phaser.Easing.Quintic.Out,!1,t.TWEEN_DELAY+t.TWEEN_TIME),this._tweenAlpha2.onComplete.add(function(){this.exists=!1,this.visible=!1},this)}return __extends(t,e),t.prototype.tween=function(){this._tweenScale.isRunning&&(this._tweenScale.stopAndRemoveFromUpdateQueue(),this._tweenAlpha.stopAndRemoveFromUpdateQueue(),this._tweenAlpha2.stopAndRemoveFromUpdateQueue()),this.alpha=1,this._tweenAlpha2.start(),this.scale.set(4,4),this.alpha=0,this.exists=!0,this.visible=!0,this._tweenScale.start(),this._tweenAlpha.start()},t.TWEEN_DELAY=1e3,t.TWEEN_TIME=700,t}(Phaser.BitmapText);e.Title=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(e){function t(){e.call(this),this._ignoreNextResize=!1}return __extends(t,e),t.prototype.init=function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0;var e=Utils.ScreenUtils.screenMetrics;this.game.device.desktop?(this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setMinMax(.25*this.game.width,.25*this.game.height,2.5*this.game.width,2.5*this.game.height),this.scale.setUserScale(e.scaleX,e.scaleY),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setResizeCallback(this.gameResized,this)):(this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setUserScale(e.scaleX,e.scaleY),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.forceOrientation(!0,!1),this.scale.setResizeCallback(this.gameResized,this),this.scale.onOrientationChange.add(this.orientationChange,this)),this.orientationChange(this.scale,"",!0)},t.prototype.create=function(){this.game.state.start("Preloader",!0,!1)},t.prototype.gameResized=function(e,t){},t.prototype.orientationChange=function(e,t,i){},t}(Phaser.State);e.Boot=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(e){function t(){e.call(this),this._restartCounter=2}return __extends(t,e),t.prototype.create=function(){this._once=!1,this._pressed=!1,this.world.setBounds(-320,-320,320,320),this.camera.focusOnXY(0,0),this.stage.backgroundColor=3158064;var e=this.add.image(0,0,"Tut");e.anchor.setTo(.5,.5),e.inputEnabled=!0,e.events.onInputUp.add(function(){this._pressed=!0},this),this._cursorKeys=this.game.input.keyboard.createCursorKeys()},t.prototype.onGameeRestart=function(){--this._restartCounter<=0&&(this._pressed=!0,Utils.AudioUtils.playSound("Fall"))},t.prototype.onGameeButtonDown=function(e){this._pressed=!0,Utils.AudioUtils.playSound("Fall")},t.prototype.update=function(){this._once||((this._cursorKeys.left.justDown||this._cursorKeys.right.justDown||this._cursorKeys.up.justDown||this._cursorKeys.down.justDown)&&(this._pressed=!0),this._pressed&&(this._once=!0,Gamee.Gamee.instance.gameStart(),this.game.state.start("Play")))},t}(Phaser.State);e.Menu=t}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t;!function(e){e[e.NONE=0]="NONE",e[e.RIGHT=1]="RIGHT",e[e.LEFT=2]="LEFT"}(t||(t={}));var i=function(t){function i(){t.call(this),this._gameOver=!1,this._paused=!1,this._runFromRestart=!1,this._keyLeftJustDown=0,this._keyLeftDown=!1,this._gameeKeyLeftDown=!1,this._keyRightJustDown=0,this._keyRightDown=!1,this._gameeKeyRightDown=!1,this._keyDown=0}return __extends(i,t),i.prototype.create=function(){this.world.setBounds(0,-640,640,640),this.camera.bounds=null,this.camera.focusOnXY(320,-320),this._globalGroup=new Phaser.Group(this.game,this.world),this._globalGroup.position.set(320,-320),this._globalGroup.pivot.set(320,-320),this.stage.backgroundColor=3484259;var t=this.add.image(320,-320,"Bg",0,this._globalGroup);t.anchor.set(.5,.5);var i=new Phaser.Group(this.game,this._globalGroup);this._boardGroup=new e.BoardGroup(this.game,this._globalGroup);var n=new Phaser.Group(this.game,this._globalGroup);this._board=new e.Board(this.game,this),this._boardGroup.underGroup=i,this._boardGroup.overGroup=n,this._boardGroup.board=this._board,this._streakLayer=new e.StreakGroup(this.game,this.world),this._cursorKeys=this.game.input.keyboard.createCursorKeys(),e.Global.GAMEE,this.reset()},i.prototype.onGameePause=function(){this._paused=!0,this.game.paused=!0},i.prototype.onGameeUnpause=function(){this._paused=!1,this.game.paused=!1},i.prototype.onGameeRestart=function(){e.Global.game.paused=!1,this._paused=!1,this.reset(),Gamee.Gamee.instance.gameStart(),Utils.AudioUtils.playSound("Fall")},i.prototype.onGameeButtonDown=function(e){var t=Gamee.Gamee.instance;t.gameRunning?"left"===e?(this._keyLeftJustDown=-1,this._gameeKeyLeftDown=!0):"right"===e?(this._keyRightJustDown=1,this._gameeKeyRightDown=!0):"down"===e&&(this._keyDown=1):this._runFromRestart||(t.gameStart(),Utils.AudioUtils.playSound("Start"),this._paused=!1)},i.prototype.onGameeButtonUp=function(e){var t=Gamee.Gamee.instance;t.gameRunning&&("left"===e?this._gameeKeyLeftDown=!1:"right"===e?this._gameeKeyRightDown=!1:"down"===e&&(this._keyDown=0))},i.prototype.reset=function(){this._keyLeftJustDown=this._keyRightJustDown=this._keyDown=0,this._keyLeftDown=this._keyRightDown=this._gameeKeyLeftDown=this._gameeKeyRightDown=!1,e.BlockTypes.randomize(),this._boardGroup.reset(),this._board.reset(),this._streakLayer.reset(),this._gameOver=!1,this._score=0,e.Global.GAMEE&&(this._paused=!0)},i.prototype.update=function(){if(!this._gameOver&&!this._tweenRunning){this._cursorKeys.left.justDown&&(this._keyLeftJustDown=-1,this._keyLeftDown=!0),this._cursorKeys.left.isUp&&(this._keyLeftDown=!1),this._cursorKeys.right.justDown&&(this._keyRightJustDown=1,this._keyRightDown=!0),this._cursorKeys.right.isUp&&(this._keyRightDown=!1);var t=this._keyLeftJustDown,i=this._keyRightJustDown;0!==this._keyRightJustDown||0!==this._keyLeftJustDown?(this._keyRightJustDown=this._keyLeftJustDown=0,this._keyTimer=e.Gameplay.KEY_DELAY_FIRST):(this._keyLeftDown||this._keyRightDown||this._gameeKeyLeftDown||this._gameeKeyRightDown)&&(this._keyTimer-=this.game.time.physicsElapsed)<=0&&(this._keyTimer=e.Gameplay.KEY_DELAY,this._keyLeftDown||this._gameeKeyLeftDown?t=-1:(this._keyRightDown||this._gameeKeyRightDown)&&(i=1));var n=this._cursorKeys.down.isDown||1===this._keyDown;if(this._board.fastFall=n,e.Global.GAMEE&&this._paused){if(t+i===0&&!n)return;this._paused=!1}this._board.moveBlock(t+i),this._gameOver||this._board.update()}},i.prototype.shutdown=function(){},i.prototype.onAddScore=function(t){this._score+=t,e.Global.GAMEE&&(Gamee.Gamee.instance.score=this._score)},i.prototype.onBlockSpawned=function(e){this._boardGroup.onBlockSpawned(e),this._keyDown=0},i.prototype.onBlockDestroyed=function(e){this._boardGroup.onBlockDestroyed(e)},i.prototype.onBlockMergeFinish=function(e){this._boardGroup.onBlockMergeFinish(e)},i.prototype.onExplodeSun=function(e){this._boardGroup.onExplodeSun(e),Utils.AudioUtils.playSound("Explosion")},i.prototype.onKilledBySun=function(e,t){this._boardGroup.onKilledBySun(e,t)},i.prototype.onExplodeSpaceship=function(e){this._boardGroup.onExplodeSpaceship(e)},i.prototype.onExplodeBlackhole=function(e){this._boardGroup.onExplodeBlackhole(e),Utils.AudioUtils.playSound("Blackhole")},i.prototype.onGameOver=function(t){this._gameOver=!0,Utils.AudioUtils.playSound("GameOver"),this.game.time.events.add(i.KILL_DELAY,function(){this._board.killAll(this._boardGroup)},this),this.game.time.events.add(i.TWEEN_DELAY+2*i.TWEEN_TIME,function(){this._gameOver&&(e.Global.GAMEE?(this._runFromRestart=!0,Gamee.Gamee.instance.gameOver()):this.reset())},this)},i.prototype.onBoardRise=function(){var t=Math.floor(1e3*e.Gameplay.RISE_TIME),i=this.game.add.tween(this.camera).to({x:this.camera.x+5},t,function(t){return e.Easing.wiggle(t,-1,2)},!1),n=this.game.add.tween(this.camera).to({y:this.camera.y+2},t,function(t){return e.Easing.wiggle(t,3,1)},!1);i.start(),n.start(),Utils.AudioUtils.playSound("Quake")},i.prototype.onStreak=function(t,i){var n=t.x*e.Gameplay.BLOCK_WIDTH+e.Gameplay.BLOCK_WIDTH/2,o=-t.y*e.Gameplay.BLOCK_HEIGHT-e.Gameplay.BLOCK_HEIGHT/2;this._streakLayer.addStreak(n,o,i)},i.prototype.onStreakTitle=function(e){this._streakLayer.showTitle(e)},i.prototype.onFallEnded=function(e){this._boardGroup.onFallEnded(e)},i.TWEEN_TIME=800,i.TWEEN_DELAY=1e3,i.KILL_DELAY=1e3,i}(Phaser.State);e.Play=i}(Meteoric||(Meteoric={}));var Meteoric;!function(e){var t=function(t){function i(){t.call(this),this._ready=!1}return __extends(i,t),i.prototype.preload=function(){var e="assets/";this.load.audio("SFX",["assets/sfx.ogg","assets/sfx.m4a"]),this.load.image("Bg",e+"bg.png"),this.load.image("Tut",e+"meteo.jpg"),this.load.atlas("Sprites",e+"Sprites.png",e+"Sprites.json"),this.load.bitmapFont("Font",e+"font.png",e+"font.xml"),this.load.json("Config",e+"config.json")},i.prototype.loadUpdate=function(){this.setLoadingText(this.load.progress)},i.prototype.create=function(){this.readConfig();var e=this.add.audio("SFX");Utils.AudioUtils.setSounds(e),e.allowMultiple=!0;var t=0;this.game.device.iOS&&(t=.1),e.addMarker("Explosion",0,1.6678),e.addMarker("Fall",3-t,.0515+t),e.addMarker("Impact",5-t,.4462+t),e.addMarker("MatchAsteroid",7-t,.7817+t),e.addMarker("MatchPlanet",9-t,.8493+t),e.addMarker("MatchSun",11-t,1.0562+t),e.addMarker("SmallCheer",14-t,1.8016+t),e.addMarker("Quake",17-t,2.6425+t),e.addMarker("TrashImpact",21-t,.3941+t),e.addMarker("GameOver",23-t,3.3717+t),e.addMarker("Blackhole",28-t,1.4133+t),e.addMarker("BigCheer",31-t,3.5449+t)},i.prototype.readConfig=function(){var t=this.game.cache.getJSON("Config");void 0!==t.KEY_DELAY_FIRST&&(e.Gameplay.KEY_DELAY_FIRST=t.KEY_DELAY_FIRST),void 0!==t.KEY_DELAY&&(e.Gameplay.KEY_DELAY=t.KEY_DELAY),void 0!==t.PLANETS_COUNT&&(e.Gameplay.PLANETS_COUNT=t.PLANETS_COUNT),void 0!==t.SPAWN_FROM_ITEM&&(e.Gameplay.SPAWN_FROM_ITEM=t.SPAWN_FROM_ITEM,e.Gameplay.INIT_FROM_ITEM=t.SPAWN_FROM_ITEM),void 0!==t.SPAWN_TO_ITEM&&(e.Gameplay.SPAWN_TO_ITEM=t.SPAWN_TO_ITEM),void 0!==t.PLANET_COUNT_STEP_1&&(e.Gameplay.PLANET_COUNT_STEP_1=t.PLANET_COUNT_STEP_1),void 0!==t.PLANET_COUNT_STEP_2&&(e.Gameplay.PLANET_COUNT_STEP_2=t.PLANET_COUNT_STEP_2),void 0!==t.MATCH_LENGTH&&(e.Gameplay.MATCH_LENGTH=t.MATCH_LENGTH),void 0!==t.MAX_SCORE_STREAK&&(e.Gameplay.MAX_SCORE_STREAK=t.MAX_SCORE_STREAK),void 0!==t.FALL_DELAY&&(e.Gameplay.FALL_DELAY=t.FALL_DELAY),void 0!==t.FALL_SPEED&&(e.Gameplay.FALL_SPEED=t.FALL_SPEED),void 0!==t.FAST_FALL_MULTIPLIER&&(e.Gameplay.FAST_FALL_MULTIPLIER=t.FAST_FALL_MULTIPLIER),void 0!==t.PLANET_FALL_MULTIPLIER&&(e.Gameplay.PLANET_FALL_MULTIPLIER=t.PLANET_FALL_MULTIPLIER),void 0!==t.MERGE_TIME&&(e.Gameplay.MERGE_TIME=t.MERGE_TIME),void 0!==t.RISE_TIME&&(e.Gameplay.RISE_TIME=t.RISE_TIME),void 0!==t.INITIAL_ROWS&&(e.Gameplay.INITIAL_ROWS=t.INITIAL_ROWS),void 0!==t.SKIP_PROBABILITY&&(e.Gameplay.SKIP_PROBABILITY=t.SKIP_PROBABILITY),void 0!==t.SKIP_PROBABILITY_STEP&&(e.Gameplay.SKIP_PROBABILITY_STEP=t.SKIP_PROBABILITY_STEP),void 0!==t.MINIMAL_OBJECTS_COUNT&&(e.Gameplay.MINIMAL_OBJECTS_COUNT=t.MINIMAL_OBJECTS_COUNT),void 0!==t.SPACESHIP_FALL_ROUND_MIN&&(e.Gameplay.SPACESHIP_FALL_ROUND_MIN=t.SPACESHIP_FALL_ROUND_MIN),void 0!==t.SPACESHIP_FALL_ROUND_MAX&&(e.Gameplay.SPACESHIP_FALL_ROUND_MAX=t.SPACESHIP_FALL_ROUND_MAX),void 0!==t.RISE_ROUND_MIN&&(e.Gameplay.RISE_ROUND_MIN=t.RISE_ROUND_MIN),void 0!==t.RISE_ROUND_MAX&&(e.Gameplay.RISE_ROUND_MAX=t.RISE_ROUND_MAX),void 0!==t.BLACKHOLE_SPAWN_MIN&&(e.Gameplay.BLACKHOLE_SPAWN_MIN=t.BLACKHOLE_SPAWN_MIN),void 0!==t.BLACKHOLE_SPAWN_MAX&&(e.Gameplay.BLACKHOLE_SPAWN_MAX=t.BLACKHOLE_SPAWN_MAX),void 0!==t.CONSECUTIVE_MATCHES_FOR_BLACKHOLE&&(e.Gameplay.CONSECUTIVE_MATCHES_FOR_BLACKHOLE=t.CONSECUTIVE_MATCHES_FOR_BLACKHOLE)},i.prototype.update=function(){this._ready===!1&&(this._ready=!0,this.game.state.start("Menu"))},i.prototype.setLoadingText=function(e){},i}(Phaser.State);e.Preloader=t}(Meteoric||(Meteoric={}));var Utils;!function(e){var t=function(){function e(){}return e.setSounds=function(t){e._sfx=t},e.playSound=function(t){Meteoric.Global.soundOn&&null!==e._sfx&&e._sfx.play(t)},e.addMusic=function(t,i){e._music[t]=i},e.playMusic=function(t,i){if(void 0===i&&(i=!0),e._currentMusic!==t&&(null!==e._currentMusic&&e._currentMusic.length>0&&e.stopMusic(),t in e._music&&Meteoric.Global.musicOn)){e._currentMusic=t;var n=e._music[t];n.loop=i,n.play()}},e.stopMusic=function(){null!==e._currentMusic&&e._currentMusic.length>0&&(e._music[e._currentMusic].stop(),e._currentMusic="")},e.pauseMusic=function(){null!==e._currentMusic&&e._currentMusic.length>0&&e._music[e._currentMusic].pause()},e.resumeMusic=function(){null!==e._currentMusic&&e._currentMusic.length>0&&e._music[e._currentMusic].resume()},e._sfx=null,e._music={},e._currentMusic="",e}();e.AudioUtils=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.supported=function(){var e=Meteoric.Global.game;return e.scale.compatibility.supportsFullScreen},e.isFullscreen=function(){return Meteoric.Global.game.scale.isFullScreen},e.changeFullscreen=function(){var t=Meteoric.Global.game;e._fullscreen?t.scale.stopFullScreen():t.scale.startFullScreen(!1,!1)},e.onEnterFullscreen=function(){e._fullscreen=!0,null!==e._listener&&e._listener.call(e._listenerContext,!0)},e.onLeaveFullscreen=function(){e._fullscreen=!1,null!==e._listener&&e._listener.call(e._listenerContext,!1);
},e.setListener=function(t,i){e._listener=t,e._listenerContext=i},e.removeListener=function(){e._listener=null,e._listenerContext=null},e._fullscreen=!1,e._listener=null,e._listenerContext=null,e}();e.FullscreenUtils=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.ChangeAnimationPhaserJSONData=function(e){Phaser.AnimationParser.myCallback=e,Phaser.AnimationParser.JSONData=function(e,t){if(t.frames){for(var i=new Phaser.FrameData,n=t.frames,o=0;o<n.length;o++){var a=i.addFrame(new Phaser.Frame(o,n[o].frame.x,n[o].frame.y,n[o].frame.w,n[o].frame.h,n[o].filename));n[o].trimmed&&a.setTrim(n[o].trimmed,n[o].sourceSize.w,n[o].sourceSize.h,n[o].spriteSourceSize.x,n[o].spriteSourceSize.y,n[o].spriteSourceSize.w,n[o].spriteSourceSize.h),Phaser.AnimationParser.myCallback(a,n[o])}return i}}},e.AdjustTweenFunctions=function(){Phaser.TweenManager.prototype.removeFromUpdateQueue=function(e){var t=this._tweens.indexOf(e);-1!==t?this._tweens.splice(t,1):(t=this._add.indexOf(e),-1!==t&&this._add.splice(t,1))},Phaser.Tween.prototype.stopAndRemoveFromUpdateQueue=function(e){var t=this,i=t.stop(e);return t.manager.removeFromUpdateQueue(t),t.pendingDelete=!1,i}},e}();e.PhaserUtils=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e}();e.ScreenMetrics=t,function(e){e[e.PORTRAIT=0]="PORTRAIT",e[e.LANDSCAPE=1]="LANDSCAPE"}(e.Orientation||(e.Orientation={}));var i=e.Orientation,n=function(){function e(){}return e.calculateScreenMetrics=function(e,n,o,a,s){void 0===o&&(o=i.LANDSCAPE);var r,l;r=window.innerWidth,l=window.innerHeight,r=Math.min(r,1.5*e),l=Math.min(l,1.5*n),("undefined"==typeof a||"undefined"==typeof s)&&(o===i.LANDSCAPE?(a=Math.round(640*e/640),s=Math.round(640*n/640)):(a=Math.round(640*e/640),s=Math.round(640*n/640)));var h=(o===i.LANDSCAPE,1),c=r/l,u=0,_=0,p=0,m=0;c>h?(m=n,p=2*Math.ceil(m*c/2),p=Math.min(p,a),u=(p-e)/2,_=0):(p=e,m=2*Math.ceil(p/c/2),m=Math.min(m,s),u=0,_=(m-n)/2);var d=r/p,f=l/m;return this.screenMetrics=new t,this.screenMetrics.windowWidth=r,this.screenMetrics.windowHeight=l,this.screenMetrics.defaultGameWidth=e,this.screenMetrics.defaultGameHeight=n,this.screenMetrics.maxGameWidth=a,this.screenMetrics.maxGameHeight=s,this.screenMetrics.gameWidth=p,this.screenMetrics.gameHeight=m,this.screenMetrics.scaleX=d,this.screenMetrics.scaleY=f,this.screenMetrics.offsetX=u,this.screenMetrics.offsetY=_,this.screenMetrics},e}();e.ScreenUtils=n}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e}(),i=function(){function e(){}return e.save=function(){if(e.localStorageSupported()){var i=new t;i.musicOn=Meteoric.Global.musicOn,i.soundOn=Meteoric.Global.soundOn,i.currentLanguage=Meteoric.Global.currentLanguage;var n=JSON.stringify(i);localStorage.setItem("meteoric_save",n)}},e.load=function(){if(e.localStorageSupported()){var t=JSON.parse(localStorage.getItem("meteoric_save"));return null===t||void 0===t?!1:(Meteoric.Global.musicOn=t.musicOn,Meteoric.Global.soundOn=t.soundOn,Meteoric.Global.currentLanguage=t.currentLanguage,!0)}},e.localStorageSupported=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},e}();e.StorageUtils=i}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.padNumber=function(e,t,i){void 0===i&&(i="0");var n=e+"";return n.length>=t?n:new Array(t-n.length+1).join(i)+n},e}();e.StringUtils=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.isAndroidStockBrowser=function(){var e=navigator.userAgent,t=/Android/.test(e),i=/Chrome/.test(e);return t&&!i},e}();e.SystemUtils=t}(Utils||(Utils={}));var Utils;!function(e){var t=function(){function e(){}return e.setTexts=function(t){e._texts=t},e.getText=function(t){if(null===e._texts)return"Texts not set";var i=e._texts;if(void 0===i[t])return"";var n=i[t][Meteoric.Global.currentLanguage];return void 0===n&&(Meteoric.Global.currentLanguage="en",n=i[t][Meteoric.Global.currentLanguage]),n},e.game=null,e._texts=null,e}();e.TextUtils=t}(Utils||(Utils={}));