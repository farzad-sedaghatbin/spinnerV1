$("#gameeMobile").remove();var loc=window.localization;Pace.on("done",function(){$(".in-app-preloader").hide()});foo=function(){};foo.prototype.showOverlay=function(el){$(".js-overlay").hide();$(el).show();$(".gameFrame").blur();$(".js-overlayWrap").fadeIn();$(window).focus()};foo.prototype.hideOverlay=function(){$(".js-overlayWrap").fadeOut();$(".gameFrame").focus()};var timer=function(){this.t=null};timer.prototype.start=function(){this.t=setInterval(function(){++window.gameeUI.playTime},1e3)};timer.prototype.pause=function(){console.log("Pause timer");clearTimeout(this.t)};timer.prototype.resume=function(){this.t=setInterval(function(){++window.gameeUI.playTime},1e3)};timer.prototype.stop=function(){clearTimeout(this.t);window.gameeUI.playTime=0};var gameeUI=function(){this.currentState="init";this.gameMode="normal";this.playTime=0;this.score=0;this.highScore=$(".js-highscore").length?parseInt($(".js-highscore").html().replace(/\s+/g,"")):0;this.gameeVer=1;this.foo=new foo;this.timer=new timer;this.playDisabled=true;this.onboardingComplete=null;this.myPhoto=null};var GameeBridge={resume:function(){isGamee2()?gameeUI.game2.resume():window.gameeUI.game.resume()},start:function(){isGamee2()?gameeUI.game2.start(false):""},pause:function(){isGamee2()?gameeUI.game2.pause():window.gameeUI.game.pause()},restart:function(){isGamee2()?gameeUI.game2.start(false):window.gameeUI.game.restart()}};gameeUI.prototype.init=function(data,cb){console.log("GameeJS 2: init");this.gameeVer=2;var result={controller:data.controller,capabilities:{saveState:undefined,replayData:undefined,socialData:undefined},sound:true};cb(result)};gameeUI.prototype.gameReady=function(){console.log("GameeJS 2: ready");this.setGameReady()};gameeUI.prototype.requestSocial=function(){console.log("GameeJS 2: Socials requested")};gameeUI.prototype.saveState=function(){console.log("GameeJS 2: save state")};gameeUI.prototype.setController=function(){this.setGameReady()};gameeUI.prototype.gameTwLink=function(score){return"https://twitter.com/share?text=Attention%20please,%20I%20have%20just%20scored%20"+score+"%20in%20"+gameGlobals.game_name+"!%20%40gameeapp%20&url="+gameGlobals.game_url};gameeUI.prototype.gameLoaded=function(){this.game=gameeGame($(".gameFrame")[0]);gameeUI.game2=gamee2Game($(".gameFrame")[0],gameeUI)};gameeUI.prototype.updateScore=function(i){var scoreString=parseInt(i);var scorePercents=i/(this.highScore/100)+"%";window.gameeUI.score=i;$(".js-score").html(scoreString);$(".js-scoreUnderlay").height(scorePercents)};gameeUI.prototype.gameStart=function(){this.currentState="playing";this.timer.start();this.updateScore(0);if(isGamee2()){GameeBridge.start(false)}};gameeUI.prototype.gameOver=function(){var totalScore=parseInt($(".js-score").html());this.currentState="gameOver";this.timer.stop();this.foo.showOverlay(".js-overlayOver");$(".share-tw").attr("href",this.gameTwLink(totalScore));$(".this-share").addClass("visible");this.saveScore(window.gameeUI.score);if(!isTelegram()){this.sendMixpanel(window.gameeUI.score)}ga("send",{hitType:"event",eventCategory:"Game",eventAction:"Played",eventLabel:""+gameGlobals.game_name+""})};gameeUI.prototype.gameRestart=function(){$(".this-share").removeClass("visible");GameeBridge.restart()};gameeUI.prototype.gamePause=function(){this.currentState="paused";this.timer.pause();this.foo.showOverlay(".js-overlayPaused")};gameeUI.prototype.gameResume=function(){this.currentState="playing";this.foo.hideOverlay();this.timer.resume();GameeBridge.resume()};gameeUI.prototype.pauseGame=function(){this.gamePause();GameeBridge.pause();this.timer.pause()};gameeUI.prototype.setGameReady=function(){setTimeout(function(){gameeUI.playDisabled=false;$(".js-overlayWrap").addClass("gameReady")},400)};gameeUI.prototype.sendMixpanel=function(totalScore){mixpanel.track("Game Played",{"game name":gameGlobals.game_name,"game genre":gameGlobals.game_genre,"game score":totalScore,"game play time":this.playTime,source:gameGlobals.game_source,"web version":"desktop",mode:this.gameMode})};gameeUI.prototype.sendMixpanelShare=function(share_type,share_screen,share_version,share_button_var){mixpanel.track("Web Game Shared",{type:share_type,screen:share_screen,"web version":share_version,"game name":gameGlobals.game_name,"button variant":share_button_var})};gameeUI.prototype.saveScore=function(score){var url=window.location.pathname,timestamp=(new Date).getTime(),dataId=$("#dataId").data(),hash=CryptoJS.AES.encrypt(JSON.stringify({score:score,timestamp:timestamp}),dataId.id,{format:CryptoJSAesJson}).toString(),sData={score:score,url:url,play_time:gameeUI.playTime,hash:hash};if(isFacebook()){var fbUserData=FacebookUserData.getUserData();sData["app_scoped_user_id"]=fbUserData.app_scoped_user_id;sData["user_id"]=fbUserData.user_id}gameeUI.sendScoreData(sData)};gameeUI.prototype.sendScoreData=function(sData){var jsonStringData=JSON.stringify(sData);var apiUrl=getBotsApiUrl()+"/set-web-score-qkfnsog26w7173c9pk7whg0iau7zwhdkfd7ft3tn";$.ajax({type:"POST",url:apiUrl,data:jsonStringData,success:function(data){console.log("Gamee: score saved");if(isTelegram()||isKik()||isFacebook()){window.gameeUI.getFullRankings()}},dataType:"json",crossDomain:true})};gameeUI.prototype.setFullRankings=function(data){var rank=data.result.ranking,myRank=data.result.myRank===null?"0":data.result.myRank,membersCount=data.result.membersCount;$(".js-overlayOver .membersCount").html(membersCount);$(".js-overlayOver .myPosition").html(myRank+nth(myRank));$("#sidebar-ranks .items .row").remove();for(var r in rank){var meClass=rank[r].rank===myRank?"me":"",avatar='<div class="avatar"><div class="img-wrap"><img src="'+addProfilePicture(rank[r].profile_picture)+'" class="pic" onerror="this.src=\'../detail/assets/png/avatar-placeholder.png\';" /></div></div>';$("#sidebar-ranks  .items").append('<div class="row '+meClass+'">'+'<div class="line">'+'<div class="number">'+rank[r].rank+".</div>"+avatar+'<div class="name">'+htmlspecialchars(rank[r].username)+"</div>"+'<div class="points">'+rank[r].score+"</div>"+"</div>"+"</div>")}};gameeUI.prototype.getFullRankings=function(){var url=window.location.pathname;var sData={url:escape(url)};if(isFacebook()){sData.facebook_user_id=FacebookUserData.getUserData().app_scoped_user_id}var apiUrl=getBotsApiUrl()+"/api/game-url-ranking";$.ajax({type:"GET",url:apiUrl,data:sData,xhrFields:{withCredentials:true},success:function(data){console.log("Game: requested rankings");window.gameeUI.setFullRankings(data)},beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Basic "+btoa("web-api:1k2tnlowfvzfjursfhf523fuenc1guzwxfq8jgc8"))},error:function(jqXHR,textStatus){},dataType:"json",crossDomain:true})};gameeUI.prototype.getStats=function(){var url=window.location.pathname;var sData={url:escape(url)};if(isFacebook()){var oThis=this;FacebookUserData.addAfterLoginCallback(function(){sData.facebook_user_id=FacebookUserData.getUserData().app_scoped_user_id;if(FacebookUserData.isLoggedIn()){oThis.getSurroundingRankings(sData)}else{$("#sidebar-ranks .ranks-wrap").hide();$(".msg-wrap.fb-connect").css("display","table")}})}else{this.getSurroundingRankings(sData)}};gameeUI.prototype.getSurroundingRankings=function(sData){var apiUrl=getBotsApiUrl()+"/api/game-url-surrounding-ranking";$.ajax({type:"GET",url:apiUrl,data:sData,success:function(data){if(!isEmpty(data.result.ranking)){window.gameeUI.getFullRankings()}},xhrFields:{withCredentials:true},beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Basic "+btoa("web-api:1k2tnlowfvzfjursfhf523fuenc1guzwxfq8jgc8"))},error:function(jqXHR,textStatus){},crossDomain:true})};window.gameeUI=new gameeUI;$(window).on("keypress",function(e){if(e.keyCode==0||e.keyCode==32){if(window.gameeUI.currentState=="init"&&gameeUI.playDisabled===false){$(".js-overlayPlay").addClass("this-triggered");window.gameeUI.foo.hideOverlay();gameeUI.gameStart();setTimeout(function(){$(".js-overlayPlay").removeClass("this-triggered")},1e3)}else if(window.gameeUI.currentState=="playing"){}else if(window.gameeUI.currentState=="paused"){window.gameeUI.gameResume()}else if(window.gameeUI.currentState=="gameOver"){window.gameeUI.foo.hideOverlay();GameeBridge.restart()}}if(e.keyCode===114||e.keyCode===82){if(window.gameeUI.currentState=="gameOver"){window.gameeUI.foo.hideOverlay();GameeBridge.restart()}}});$(".child-pushSpace").on("click",function(e){console.log("Space pressed.");if(window.gameeUI.currentState=="init"&&gameeUI.playDisabled===false){$(".js-overlayPlay").addClass("this-triggered");window.gameeUI.foo.hideOverlay();gameeUI.gameStart();setTimeout(function(){$(".js-overlayPlay").removeClass("this-triggered")},1e3)}else if(window.gameeUI.currentState=="playing"){}else if(window.gameeUI.currentState=="paused"){window.gameeUI.gameResume()}else if(window.gameeUI.currentState=="gameOver"){window.gameeUI.foo.hideOverlay();GameeBridge.restart()}});$(".js_resume").on("click",function(e){window.gameeUI.gameResume()});var overlayEmbed=$(".overlay-embed");var clipboard=new Clipboard(".btn-copy");clipboard.on("success",function(e){$("#game_url").css("border-color","#5ac546");$(".btn-copied").css("display","block");$(".btn-copy").css("display","none");setTimeout(function(){$(".btn-copied").css("display","none");$(".btn-copy").css("display","block")},4e3);e.clearSelection()});$(".btn-embed-game").on("click",function(e){overlayEmbed.addClass("visible");setTimeout(function(){document.getElementById("game_url").select()},500)});$(".close-popup").on("click",function(e){$(this).parents(".overlay").removeClass("visible");$("#game_url").css("border-color","#b1c1c3")});$(".preloader.main").hide();$(window).on("load",function(){var game=$(".gameFrame");window.gameeUI.gameLoaded();game.attr("src",game.data("src"));if(isBot()){window.gameeUI.getStats()}else{$("#sidebar-ranks .ranks-wrap").hide();$(".msg-wrap.fb-connect").css("display","table")}$("html").addClass("this-loaded")});$(".js_pause").on("click",function(){window.gameeUI.pauseGame()});$(".js_restart").on("click",function(){window.gameeUI.gameRestart()});$(".cRankingsBtn_close").on("click",function(e){e.preventDefault();$("#gameeDesktop #overlay-standing").removeClass("visible")});$(".this-share a, .js_shareFB, .js_shareTW, .twitter-share-button, .fb-like, .share-telegram").on("click",function(e){var share_screen=$(this).data("screen"),share_type=$(this).data("type"),share_version=$(this).data("version"),share_button_var=1;window.gameeUI.sendMixpanelShare(share_type,share_screen,share_version,share_button_var)});$(".on-fb").on("click",function(e){var botUrlBase=$("body").attr("data-bot-deep-link-base"),app_id=$("body").data("facebook-bot-app-id");FB.ui({method:"send",app_id:app_id,link:gameGlobals.game_fullUrl})});$(document).on("click",".challenge-btn.on-telegram, .share-telegram",function(e){TelegramGameProxy.shareScore()});$(".re-request-friends-permission, .action-fb-connect").on("click",function(e){e.preventDefault();FacebookUserData.forceConnect()});