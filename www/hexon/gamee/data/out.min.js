function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function linterpol(t,e,o){return[0,1].map(function(n){return e[n]+t*(o[n]-e[n])})}function vecAdd(){return[].concat(Array.prototype.slice.call(arguments)).reduce(function(t,e){var o=_slicedToArray(t,2),n=o[0],i=o[1],r=_slicedToArray(e,2);return[n+r[0],i+r[1]]})}function vecMul(t,e){return t.map(function(t){return t*e})}function augmentMouseEvent(t){t.changedTouches=[{pageX:t.pageX,pageY:t.pageY,target:{offsetLeft:t.target.offsetLeft,offsetTop:t.target.offsetTop}}]}function splitTime(t,e){return t<e?t/e:(t-e)/(1-e)}function initCanvases(t,e,o){var n=document.getElementById("wrapper");return new Map(t.map(function(t){var i=_slicedToArray(t,2),r=i[0],a=i[1],c=document.createElement("canvas");return c.id=r,c.width=e,c.height=o,c.style.zIndex=a,n.appendChild(c),[r,{canvas:c,context:c.getContext("2d"),z:a}]}))}function preload(t,e,o){var n=[];return t.forEach(function(t){var i=_slicedToArray(t,2),r=i[0],a=i[1];return n.push(o(r,e(a)))}),Promise.all(n)}function preloadImgs(t,e){return preload(e,function(t){return t},function(e,o){var n=new Image;return new Promise(function(i,r){n.onload=function(){t.set(e,n),i()},n.onerror=n.onabort=function(){return r(["image",o])},n.src=o})})}function preloadSounds(t,e,o){var n="probably"===Modernizr.audio.mp3&&new Set(o).has("mp3")?".mp3":".wav",i=AUDIOCTX;return preload(e,function(t){return t},function(e,o){var r=new XMLHttpRequest;return r.open("GET",o+n,!0),r.responseType="arraybuffer",new Promise(function(n,a){r.onload=function(){i.decodeAudioData(r.response,function(o){t.set(e,o),n()})},r.onerror=function(){return a(["sound",o])},r.send()})})}function preloadFonts(t){return preload(t,function(t){return t.reduce(function(t,e){var o=_slicedToArray(e,2),n=o[0],i=o[1];return t+(t?", ":"")+"url('"+n+"') format('"+i+"')"},"")},function(t,e){var o=new FontFace(t,e);return new Promise(function(t,n){o.load().then(function(){document.fonts.add(o),t()},function(){return n(["font",e])})})})}function _playSound(t,e,o){var n=AUDIOCTX,i=n.createBufferSource(),r=n.createGain();i.buffer=t,r.gain.value=void 0!==o?o:1,i.connect(r),r.connect(n.destination),i.start(n.currentTime+e/1e3)}function playSilentSound(){var t=AUDIOCTX,e=t.createBuffer(1,1,22050),o=t.createBufferSource();o.buffer=e,o.connect(t.destination),o.start(0),"suspended"===o.context.state&&o.context.resume()}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function getMaxDistance(t){for(var e=[].concat(_toConsumableArray(t.values())),o=0,n=[],i=[],r=[0,0];e.length>=2;)!function(){var t=_slicedToArray(e.pop()[0],2),a=t[0],c=t[1];r=vecAdd(r,[a,c]),e.forEach(function(t){var e=_slicedToArray(t,1),r=_slicedToArray(e[0],2),s=r[0],l=r[1],u=Math.sqrt(Math.pow(s-a,2)+Math.pow(l-c,2));u>o&&(o=u,n=[a,c],i=[s,l])})}();return r=vecAdd(r,e.pop()[0]).map(function(e){return e/t.size}),Math.floor(2*Math.random())?[[n,i],o,r]:[[i,n],o,r]}function getPivot(t,e){var o=_slicedToArray(t,3),n=o[2],i=_slicedToArray(e,2);return vecAdd(n,[i[0]/2,i[1]/2])}function getDistance(t,e){var o=_slicedToArray(t,2),n=_slicedToArray(o[0],2),i=_slicedToArray(n[0],2),r=i[0],a=i[1],c=_slicedToArray(n[1],2),s=c[0],l=c[1],u=o[1],d=_slicedToArray(e,2),h=d[0],f=d[1],g=[s-r,l-a],p=Math.sqrt(Math.pow(g[0],2)+Math.pow(g[1],2)),w=[g[0]/p,g[1]/p],v=w[0]*(h-r)+w[1]*(f-a);return Math.min(1,Math.max(v/u,0))}function wave(t){var e=config.duration2cellPeakRatio,o=1-config.peakSize;return t<e?linterpol(t/e,[0,0],[e,o])[1]:linterpol((t-e)/(1-e),[e,o],[1,1])[1]}function prerenderText(t){var e=window.config,o=document.createElement("canvas"),n=o.getContext("2d");n.font=e.fontSize+" ubuntu",n.textBaseline="middle";var i=[n.measureText(t).width,n.measureText("MM").width],r=i[0],a=i[1];return o.width=r,o.height=a,n.font=e.fontSize+" ubuntu",n.textBaseline="middle",n.fillStyle=e.fontFillStyle,n.strokeStyle=e.fontStrokeStyle,n.lineWidth=e.fontLineWidth,n.fillText(t,0,a/2),n.strokeText(t,0,a/2),o}!function(t,e,o){function n(t,e){return typeof t===e}function i(){return"function"!=typeof e.createElement?e.createElement(arguments[0]):u?e.createElementNS.call(e,"http://www.w3.org/2000/svg",arguments[0]):e.createElement.apply(e,arguments)}var r=[],a=[],c={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,e){var o=this;setTimeout(function(){e(o[t])},0)},addTest:function(t,e,o){a.push({name:t,fn:e,options:o})},addAsyncTest:function(t){a.push({name:null,fn:t})}},s=function(){};s.prototype=c,s=new s;var l=e.documentElement,u="svg"===l.nodeName.toLowerCase();s.addTest("audio",function(){var t=i("audio"),e=!1;try{(e=!!t.canPlayType)&&(e=new Boolean(e),e.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),e.mp3=t.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,""),e.opus=t.canPlayType('audio/ogg; codecs="opus"')||t.canPlayType('audio/webm; codecs="opus"').replace(/^no$/,""),e.wav=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),e.m4a=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(t){}return e}),function(){var t,e,o,i,c,l,u;for(var d in a)if(a.hasOwnProperty(d)){if(t=[],e=a[d],e.name&&(t.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(o=0;o<e.options.aliases.length;o++)t.push(e.options.aliases[o].toLowerCase());for(i=n(e.fn,"function")?e.fn():e.fn,c=0;c<t.length;c++)l=t[c],u=l.split("."),1===u.length?s[u[0]]=i:(!s[u[0]]||s[u[0]]instanceof Boolean||(s[u[0]]=new Boolean(s[u[0]])),s[u[0]][u[1]]=i),r.push((i?"":"no-")+u.join("-"))}}(),function(t){var e=l.className,o=s._config.classPrefix||"";if(u&&(e=e.baseVal),s._config.enableJSClass){var n=new RegExp("(^|\\s)"+o+"no-js(\\s|$)");e=e.replace(n,"$1"+o+"js$2")}s._config.enableClasses&&(e+=" "+o+t.join(" "+o),u?l.className.baseVal=e:l.className=e)}(r),delete c.addTest,delete c.addAsyncTest;for(var d=0;d<s._q.length;d++)s._q[d]();t.Modernizr=s}(window,document);var _createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),_slicedToArray=function(){function t(t,e){var o=[],n=!0,i=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(o.push(a.value),!e||o.length!==e);n=!0);}catch(t){i=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw r}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),AUDIOCTX=new(window.AudioContext||window.webkitAudioContext),Scene=function(){function t(){_classCallCheck(this,t),this.counter=0,this.animations=new Map}return _createClass(t,[{key:"addAnimation",value:function(t,e,o,n,i,r){var a=r||this.counter++;this.animations.set(a,{animate:t,duration:e,start:n,repeat:i,post:o})}},{key:"removeAnimation",value:function(t){this.animations.delete(t)}},{key:"removeAllAnimations",value:function(){this.animations.clear()}},{key:"render",value:function(t){var e=this;[].concat(_toConsumableArray(this.animations.entries())).forEach(function(o){var n=_slicedToArray(o,2),i=n[0],r=n[1],a=r.animate,c=r.duration,s=r.start,l=r.repeat,u=r.post,d=c?l?(t-s)%c/c:(t-s)/c:1;l?a(d):(d>=0&&a(d>1?1:d),(d>=1||0===c)&&(e.removeAnimation(i),u&&u()))})}}]),t}(),Game=function(){function t(e,o,n,i){var r=this;_classCallCheck(this,t);var a=this;this.config=window.config,this.width=n,this.web=!!i&&window.innerHeight===window.innerWidth,this.realWidth=this.web?1024:this.width,this.height=this.web?1024:Math.floor(this.width*window.innerHeight/window.innerWidth),this.xOffset=Math.floor(this.realWidth-this.width)/2,this.canvas=initCanvases(o,this.realWidth,this.height),this.target=document.body,this.pausedTime=0,this.timestamp=0,this.overlay=1,this.paused=0,this.muted=0,this._score=0,this.state=function(){},this.scene=new Scene,this.onPause=function(){},this.onResume=function(){},this.controller=gamee.controller.requestController(e),gamee.onPause=function(){r.paused||(r.paused=1,r.pausedTime-=r.timestamp,r.onPause())},gamee.onResume=gamee.onUnpause=function(){r.paused&&(r.paused=0,r.pausedTime+=r.timestamp,r.onResume())},gamee.onMute=function(){r.muted=1},gamee.onUnmute=function(){r.muted=0},gamee.onStop=function(){},["touchstart","touchmove","touchend"].forEach(function(t){return a.target.addEventListener(t,function(t){return t.preventDefault()})}),["touchstart","touchend"].forEach(function(t){return a.target.addEventListener(t,function(t){playSilentSound(),this.removeEventListener(t.type,arguments.callee,t.eventPhase)},!0)}),this.augmentMouseEvents()}return _createClass(t,[{key:"now",value:function(){return this.timestamp-this.pausedTime}},{key:"requestLoop",value:function(){var t=this;requestAnimationFrame(function(e){return t.mainLoop.call(t,e)})}},{key:"mainLoop",value:function(t){if(this.timestamp=t,!this.paused){var e=this.now();this.state(e),this.scene.render(e)}this.requestLoop()}},{key:"playSound",value:function(t,e,o){this.overlay||this.muted||_playSound(this.sounds.get(t),e,o)}},{key:"augmentMouseEvents",value:function(){var t=this;"ontouchstart"in window||"ontouchstart"in document.documentElement||window.ontouchstart||window.onmsgesturechange||window.DocumentTouch&&window.document instanceof window.DocumentTouch||([["onmousedown","ontouchstart"],["onmouseup","ontouchend"],["onmousemove","ontouchmove"]].forEach(function(e){var o=_slicedToArray(e,2),n=o[0],i=o[1];t.target[n]=function(e){t.target[i]&&(augmentMouseEvent(e),t.target[i](e))}}),this.target.onmouseup&&(document.onmouseup=this.target.onmouseup,this.target.onmouseup=void 0))}},{key:"getMousePos",value:function(t){var e=t.changedTouches[0],o=[[this.realWidth,e.pageX-e.target.offsetLeft,this.target.clientWidth],[this.height,e.pageY-e.target.offsetTop,this.target.clientHeight]].map(function(t){var e=_slicedToArray(t,3),o=e[0],n=e[1],i=e[2];return Math.round(o*n/i)}),n=_slicedToArray(o,2),i=n[0],r=n[1];return[i-this.xOffset,r]}},{key:"unbindEvents",value:function(){var t=this;["ontouchstart","ontouchend","ontouchmove"].forEach(function(e){return t.target[e]=void 0})}},{key:"score",get:function(){return this._score},set:function(t){this._score=t,t&&(gamee.score=t)}}]),t}();!function(){var t=function(){var t=this,e={};t.on=function(t,o,n){if(!(arguments.length<2||"string"!=typeof t||"function"!=typeof o)){var i=o.toString();void 0!==e[t]?void 0===e[t].callbacks[i]?e[t].callbacks[i]={cb:o,once:!!n}:"boolean"==typeof n&&(e[t].callbacks[i].once=n):(e[t]={callbacks:{}},e[t].callbacks[i]={cb:o,once:!!n})}},t.once=function(e,o){t.on(e,o,!0)},t.off=function(t,o){if("string"==typeof t&&void 0!==e[t])if("function"==typeof o){var n=o.toString(),i=e[t].callbacks[n];void 0!==i&&delete e[t].callbacks[n]}else delete e[t]},t.trigger=function(o,n){if("string"==typeof o&&void 0!==e[o])for(var i in e[o].callbacks){var r=e[o].callbacks[i];"function"==typeof r.cb&&r.cb(n),"boolean"==typeof r.once&&!0===r.once&&t.off(o,r.cb)}}};"undefined"!=typeof define&&define.amd?define(function(){"use strict";return new t}):"undefined"!=typeof module&&module.exports?module.exports=new t:window.Bullet=new t}(),function(t){"use strict";function e(t){t.updateScore=function(t){window.location.href="gamee://score/"+t},t.requestController=function(t){window.location.href="gamee://request-controller/"+t},t.gameOver=function(){window.location.href="gamee://game-over"},t.gameStart=function(){window.location.href="gamee://game-start"},t.gameLoaded=function(){window.location.href="gamee://game-loaded"},t.type="gamee-mobile"}function o(t){var e=window.parent;t.updateScore=function(t){e.postMessage(["score",t],"*")},t.requestController=function(t){e.postMessage(["request-controller",t],"*")},t.additionalController=function(t){e.postMessage(["additional-controller",t],"*")},t.gameOver=function(){e.postMessage(["game-over"],"*")},t.gameStart=function(){e.postMessage(["game-start"],"*")},t.gamePaused=function(){e.postMessage(["game-paused"],"*")},t.gameLoaded=function(){e.postMessage(["game-loaded"],"*")},t.type="gamee-web"}var n={updateScore:function(t){},requestController:function(t){},additionalController:function(t){},gameOver:function(){},gameStart:function(){},gameLoaded:function(){},type:"no-gamee"},i=navigator.userAgent.toLowerCase();/iphone|ipod|ipad/.test(i)?window.self!==window.top?o(n):e(n):/gamee\/[0-9\.]+$/.test(i)?e(n):window.parent?o(n):window.parent&&window.parent.gameeSimulator?function(t){var e=window.parent.gameeSimulator;t.updateScore=function(t){e.updateScore(t)},t.requestController=function(t){e.requestController(t)},t.gameOver=function(){e.gameOver()},t.gameStart=function(){e.gameStart()},t.gameLoaded=function(){e.gameLoaded()},t.type="gamee-simulator"}(n):console.error("No gamee enviroment matched"),t.$gameeNative=n}(this);var gamee=function(t){"use strict";function e(t,e,o){t.addEventListener?t.addEventListener(e,o,!1):t.attachEvent&&t.attachEvent("on"+e,o)}function o(t){return function(e){return e&&e.keyCode||(e||(e=window.event),e.which&&(e.keyCode=e.which)),t(e)}}var n,i=function(){},r={};return Object.defineProperty(r,"score",{get:function(){return n},set:function(e){n=e,t.$gameeNative.updateScore(n)}}),r.gameOver=function(){t.$gameeNative.gameOver()},r.gameStart=function(){t.$gameeNative.gameStart()},r.gameLoaded=function(){t.$gameeNative.gameLoaded()},r.onPause=i,r.onStop=i,r.onRestart=i,r.onMute=i,r.onUnmute=i,r.onUnpause=i,r.onResume=function(){r.onUnpause()},r._keydown=function(n){e(t,"keydown",o(n))},r._keyup=function(n){e(t,"keyup",o(n))},"gamee-web"===t.$gameeNative.type&&(r._keydown(function(t){switch(t.keyCode){case 80:r.onPause(),$gameeNative.gamePaused();break;case 82:r.onRestart()}}),e(t,"message",function(t){switch(t.data[0]){case"pause":r.onPause();break;case"resume":r.onResume();break;case"restart":window.focus(),r.onRestart();break;case"mute":r.onMute();break;case"button_button_down":r.controller.trigger("keydown",{button:"button"});break;case"button_button_up":r.controller.trigger("keyup",{button:"button"});break;case"button_left_up":r.controller.trigger("keyup",{button:"left"});break;case"button_left_down":r.controller.trigger("keydown",{button:"left"});break;case"button_right_down":r.controller.trigger("keydown",{button:"right"});break;case"button_right_up":r.controller.trigger("keyup",{button:"right"});break;case"button_up_down":r.controller.trigger("keydown",{button:"up"});break;case"button_up_up":r.controller.trigger("keyup",{button:"up"});break;case"button_down_down":r.controller.trigger("keydown",{button:"down"});break;case"button_down_up":r.controller.trigger("keyup",{button:"down"});break;case"button_a_down":r.controller.trigger("keydown",{button:"A"});break;case"button_a_up":r.controller.trigger("keyup",{button:"A"});break;case"button_b_down":r.controller.trigger("keydown",{button:"B"});break;case"button_b_up":r.controller.trigger("keyup",{button:"B"});break;default:throw Error("Unknown message")}})),r}(this);!function(t,e){"use strict";function o(t,e){var o=this;g.call(this),this._pressed=!0,this.key=t,this.keyCode=e,this.on("keydown",function(){o._pressed=!0}),this.on("keyup",function(){o._pressed=!1})}function n(){var t=this;g.call(this),this.buttons={},this.buttonAlias={},this.on("$keydown",function(e){e.button&&t.buttonAlias[e.button]&&(e.button=t.buttonAlias[e.button]),t.trigger("keydown",e)}),this.on("$keyup",function(e){e.button&&t.buttonAlias[e.button]&&(e.button=t.buttonAlias[e.button]),t.trigger("keyup",e)}),this.on("keydown",function(e){e.button&&t.buttons[e.button]&&t.buttons[e.button].trigger("keydown")}),this.on("keyup",function(e){e.button&&t.buttons[e.button]&&t.buttons[e.button].trigger("keyup")})}function i(){n.call(this),this.addButton(new o("button",32))}function r(){n.call(this),this.addButton(new o("left",37)),this.addButton(new o("right",39))}function a(){n.call(this),this.addButton(new o("up",38)),this.addButton(new o("left",37)),this.addButton(new o("right",39)),this.addButton(new o("A",32))}function c(){n.call(this),this.addButton(new o("up",38)),this.addButton(new o("left",37)),this.addButton(new o("right",39)),this.addButton(new o("down",40)),this.addButton(new o("A",32))}function s(){n.call(this),this.addButton(new o("up",38)),this.addButton(new o("left",37)),this.addButton(new o("right",39)),this.addButton(new o("down",40)),this.addButton(new o("A",32)),this.addButton(new o("B",17))}function l(){n.call(this),this.addButton(new o("up",38)),this.addButton(new o("left",37)),this.addButton(new o("right",39)),this.addButton(new o("down",40))}function u(){var t=this;n.call(this),this.on("$touchstart",function(e){t.trigger("touchstart",e)}),this.on("$touchend",function(e){t.trigger("touchend",e)}),this.on("$touchmove",function(e){t.trigger("touchmove",e)}),this.on("$touchleave",function(e){t.trigger("touchleave",e)}),this.on("$touchcancel",function(e){t.trigger("touchcancel",e)})}function d(){var t=this;n.call(this),this.x=0,this.y=0,this.on("$change",function(e){t.x=e.position.x,t.y=e.position.y,t.trigger("change",e)})}function h(){d.call(this),this.addButton(new o("button",32))}function f(t,e){var o,n;if(!w[t])throw new Error("Unsupported controller type, "+t);if(e=e||{},n=new w[t],e.enableKeyboard&&n.enableKeyboard(),e.buttons)for(o in e.buttons)n.remapButton(o,e.buttons[o]);return n}var g=Bullet.constructor;e.controller={requestController:function(e,o){var n=f(e,o);return t.$gameeNative.requestController(e),p=n,n},additionalController:function(e,o){var n=f(e,o);return t.$gameeNative.additionalController(e),n},trigger:function(){if(!p)throw new Error("No controller present");p.trigger.apply(p,arguments)}},o.prototype=Object.create(g.constructor.prototype),o.constructor=o,o.prototype.isDown=function(){return this._pressed},n.prototype=Object.create(g.constructor.prototype),n.constructor=n,n.prototype.addButton=function(t){this.buttons[t.key]=t},n.prototype.enableKeyboard=function(){var t,o,n={},i=this;for(t in this.buttons)o=this.buttons[t],o.keyCode&&(n[o.keyCode]=o);e._keydown(function(t){var e=n[t.keyCode];e&&(t.preventDefault(),i.trigger("keydown",{button:e.key}))}),e._keyup(function(t){var e=n[t.keyCode];e&&(t.preventDefault(),i.trigger("keyup",{button:e.key}))})},n.prototype.remapButton=function(t,e){if(e.name&&(e=e.name),!this.buttons[t])throw Error("Button "+t+" was not found in controller");this.buttonAlias[t]=e.name,this.buttons[e.name]=this.buttons[t],delete this.buttons[t]},i.prototype=Object.create(n.prototype),i.prototype.constructor=i,r.prototype=Object.create(n.prototype),r.prototype.constructor=r,a.prototype=Object.create(n.prototype),a.prototype.constructor=a,c.prototype=Object.create(n.prototype),c.prototype.constructor=c,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,l.prototype=Object.create(n.prototype),l.prototype.constructor=l,u.prototype=Object.create(u.prototype),u.prototype.constructor=u,d.prototype=Object.create(n.prototype),d.prototype.constructor=d,h.prototype=Object.create(d.prototype),h.prototype.constructor=h;var p,w={OneButton:i,TwoButtons:r,FourButtons:a,FiveButtons:c,SixButtons:s,FourArrows:l,Touch:u,Joystick:d,JoystickWithButton:h}}(this,gamee),window.config={gridYOffset:10,gridWidth:90,cellBorderX:10/108,cellMovingRatio:.9,slots:3,slotYOffset:80,slotYPopupOffset:63,duration1:100,duration2:240,duration2cell:160,duration2cellPeakRatio:.3,peakSize:1.3,duration3:100,duration4:200,duration5:2500,duration5ratio:.28,duration6:1e3,duration7:800,slowWaveRatio:1,slowScoreRatio:1,scorePopupRatio:1,scoreDelayRatio:.7,fingerCellRatio:2.5,fontSize:"60px",fontFillStyle:"black",fontStrokeStyle:"black",fontLineWidth:2,putGain:.4,victoryGain:1,gameOverGain:1};var _slicedToArray=function(){function t(t,e){var o=[],n=!0,i=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done)&&(o.push(a.value),!e||o.length!==e);n=!0);}catch(t){i=!0,r=t}finally{try{!n&&c.return&&c.return()}finally{if(i)throw r}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),TensGame=function(t){function e(t,o,n,i){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o,n,i)),a=r;return r.size=5,r.maxRowSize=2*r.size-1,r.colors=["blue","brown","green","purple","red","yellow"],r.pieceData=[{coords:[[[0,0],[-1,0],[-1,0],[1,-1],[1,-1]],[[0,0],[1,0],[1,0],[-1,-1],[-1,-1]]],color:0},{coords:[[[0,0],[-1,0],[-1,0],[-1,0]]],color:1},{coords:[[[0,0],[-1,-1],[-1,-1],[1,-1],[1,-1]],[[0,0],[1,-1],[1,-1],[-1,-1],[-1,-1]]],color:2},{coords:[[[0,0],[-1,-1],[1,0],[-1,-1]]],color:3},{coords:[[[0,0],[-1,-1],[1,0]]],color:4},{coords:[[[0,0],[-1,1],[1,0]]],color:4},{coords:[[[0,0],[-1,-1]]],color:5},{coords:[[[0,0],[1,-1]]],color:5}],r.config.width=r.width,r.config.height=r.height,r.config.xOffset=r.xOffset,r.sprites=new Map,r.shadows=new Map,r.sounds=new Map,r.diagonals=[0,1,2].map(function(t){return[].concat(_toConsumableArray(Array(r.maxRowSize).keys())).map(function(t){return[]})}),r.axes=new Map,r.coords=[],r.cellWidthRatio=0,r.cellHeightRatio=0,r.cellOffsetX=0,r.cellOffsetY=0,r.cellWidth=0,r.cellHeight=0,r.cellContentOffsetX=0,r.cellContentOffsetY=0,r.cellContentWidth=0,r.cellContentHeight=0,r.cellSmallWidth=0,r.cellSmallHeight=0,r.slots=[],r.slotHistory=new Map(r.pieceData.map(function(t){return[t,0]})),r.grid=new Map,gamee.onRestart=function(){r.newGame()},Promise.all([r.initSprites(),preloadSounds(r.sounds,[["new","sounds/new"],["pick","sounds/pick"],["put","sounds/put"],["victory","sounds/victory"],["gameover","sounds/gameover"]],["mp3","wav"]),preloadFonts([["ubuntu",[["fonts/UbuntuTitling-Bold-webfont.woff","woff"],["fonts/UbuntuTitling-Bold-webfont.ttf","ttf"]]]])]).then(function(){a.init(),gamee.gameLoaded(),a.requestLoop();try{"y"===window.localStorage.getItem("Hexonix_tutorial")?a.newGame():(window.localStorage.setItem("Hexonix_tutorial","y"),a.tutorial1())}catch(t){a.tutorial1()}},function(t){var e=_slicedToArray(t,2),o=e[0],n=e[1];throw console.log("Failed to load "+o+": "+n),-1}),r}return _inherits(e,t),_createClass(e,[{key:"tutorial1",value:function(){var t=this,e=this,o=this.canvas.get("pieces").context,n=this.canvas.get("shadow").context,i=this.canvas.get("finger").context,r=this.pieceData;this.slots=[new Piece(r[1].coords[0],o,e.sprites.get(e.colors[r[1].color]),0),new Piece(r[3].coords[0],o,e.sprites.get(e.colors[r[3].color]),1),new Piece(r[2].coords[0],o,e.sprites.get(e.colors[r[2].color]),2)],this.slots[0].state=this.slots[2].state="placed",this.putPiece(new Piece(r[6].coords[0],o,e.sprites.get(e.colors[r[6].color])),[3,8],!1),this.putPiece(new Piece(r[3].coords[0],o,e.sprites.get(e.colors[r[3].color])),[0,5],!1),this.putPiece(new Piece(r[4].coords[0],o,e.sprites.get(e.colors[r[4].color])),[4,8],!1),this.putPiece(new Piece(r[5].coords[0],o,e.sprites.get(e.colors[r[5].color])),[2,7],!1),this.putPiece(new Piece(r[7].coords[0],o,e.sprites.get(e.colors[r[7].color])),[0,6],!1);var a=new Piece(r[3].coords[0],n,e.sprites.get(e.colors[r[3].color]+"_shadow"));a.pos=e.grid2pixel([0,8]),a.size=[config.cellWidth,config.cellHeight],a.size2=a.size.map(function(t){return t*config.cellContentRatio}),a.state="moving",this.drawGrid(),this.drawSlots(),a.draw(),this.scene.addAnimation(function(e){var o=t.cellWidth*t.config.fingerCellRatio,n=t.sprites.get("hand"),r=o/n.width*n.height,a=[57,6].map(function(t){return-t/n.width*o}),c=vecAdd(t.slots[1].slot.bounds[0],vecMul(t.slots[1].slot.bounds[1],.5)),s=void 0;e<t.config.duration5ratio?(i.globalAlpha=e/t.config.duration5ratio,s=0):e>1-t.config.duration5ratio?(i.globalAlpha=(1-e)/t.config.duration5ratio,s=1):(i.globalAlpha=1,s=(e-t.config.duration5ratio)/(1-2*t.config.duration5ratio));var l=vecAdd(a,linterpol(s,c,t.grid2pixel([.5,8])));i.clearRect(0,0,t.realWidth,t.height),i.drawImage(n,t.xOffset+l[0],l[1],o,r)},this.config.duration5,function(){},this.now(),!0,"finger"),this.tutorial2()}},{key:"tutorial2",value:function(){var t=this;this.target.ontouchstart=function(e){if(t.overlay&&(t.overlay=0),!t.paused){var o=t.getMousePos(e),n=_slicedToArray(o,2),i=n[0],r=n[1];try{var a=t.clickedSlot([i,r]);if(a!==t.slots[1])throw-1;a.state="moving";var c=[i-a.slot.pos2[0],r-a.slot.pos2[1]];new Promise(function(e,o){t.target.ontouchend=o,t.scene.addAnimation(function(e){t.drawSlots(a);var o=Math.pow(e,2);a.pos=linterpol(o,a.slot.pos,a.slot.pos2),a.size=linterpol(o,[config.cellSmallWidth,config.cellSmallHeight],[config.cellWidth,config.cellHeight]),a.size2=linterpol(o,[config.cellSmallWidth*config.cellContentRatio,config.cellSmallHeight*config.cellContentRatio],[config.cellWidth*config.cellContentRatio*config.cellMovingRatio,config.cellHeight*config.cellContentRatio*config.cellMovingRatio]),a.draw()},config.duration1,e,t.now())}).then(function(){t.target.ontouchmove=function(e){var o=t.getMousePos(e),n=_slicedToArray(o,2),i=n[0],r=n[1];a.pos=[i-c[0],r-c[1]],t.scene.addAnimation(function(){t.drawSlots(a),a.draw()},0,void 0,void 0,void 0,"move")},new Promise(function(e,o){t.target.ontouchend=function(n){try{var i=t.pixel2grid(a.getPiecePos(t.getMousePos(n))),r=_slicedToArray(i,2),c=r[0],s=r[1];if(0!==c||8!==s)throw-1;t.putPiece(a,[c,s],!1);var l=t.grid2pixel([c,s]),u=a.pos;t.playSound("put",0,config.putGain),t.unbindEvents(),t.scene.addAnimation(function(e){t.drawSlots(a);var o=Math.pow(e,3);a.pos=linterpol(o,u,l),a.size2=linterpol(o,[config.cellWidth*config.cellContentRatio*config.cellMovingRatio,config.cellHeight*config.cellContentRatio*config.cellMovingRatio],[config.cellWidth*config.cellContentRatio,config.cellHeight*config.cellContentRatio]),a.draw()},config.duration3,function(){a.state="placed",t.scene.addAnimation(function(){t.drawGrid(),t.drawSlots(a)},0,function(){return e([a,l])})},t.now())}catch(e){a.state="initial",t.scene.addAnimation(function(){t.drawGrid(),t.drawSlots()},0,o)}finally{t.unbindEvents()}}}).then(function(e){var o=_slicedToArray(e,2),n=o[0],i=o[1];t.unbindEvents(),t.tutorial3(n,i)},t.tutorial2.bind(t))},function(){t.unbindEvents(),a.state="initial",t.scene.addAnimation(function(){t.drawGrid(),t.drawSlots()},0,t.tutorial2.bind(t))})}catch(t){return}}}}},{key:"tutorial3",value:function(t,e){var o=this,n=this,i=new Map;this.scene.removeAllAnimations(),["finger","shadow"].forEach(function(t){return o.canvas.get(t).context.clearRect(0,0,o.realWidth,o.height)}),[0,1,2].forEach(function(t){n.diagonals[t].forEach(function(t){t.every(function(t){return void 0!==n.grid.get(t)})&&t.forEach(function(t){return i.set(t,[n.grid2pixel(n.key2grid(t)),n.grid.get(t)])})})}),[].concat(_toConsumableArray(i.keys())).forEach(function(t){return o.grid.delete(t)});var r=this.canvas.get("pieces").context;this.playSound("victory",config.duration2cell*config.duration2cellPeakRatio,config.victoryGain);var a=getMaxDistance(i);this.scene.addAnimation(function(){n.drawGrid()},0),this.scene.addAnimation(function(){r.globalAlpha=1,n.drawSlots()},n.config.slowWaveRatio*(n.config.duration2+n.config.duration2cell),function(){},n.now());var c=0;i.forEach(function(t){var e=_slicedToArray(t,2),o=_slicedToArray(e[0],2),s=o[0],l=o[1],u=e[1],d=getDistance(a,[s,l]);n.scene.addAnimation(function(){r.globalAlpha=1,r.drawImage(u,n.xOffset+n.cellContentOffsetX+s,n.cellContentOffsetY+l,n.cellContentWidth,n.cellContentHeight)},n.config.slowWaveRatio*d*n.config.duration2,function(){n.scene.addAnimation(function(t){var e=wave(t),o=linterpol(e,[s,l],[s+n.cellContentWidth/2,l+n.cellContentHeight/2]),i=_slicedToArray(o,2),a=i[0],c=i[1],d=linterpol(e,[n.cellContentWidth,n.cellContentHeight],[0,0]),h=_slicedToArray(d,2),f=h[0],g=h[1];r.drawImage(u,n.xOffset+n.cellContentOffsetX+a,n.cellContentOffsetY+c,f,g)},n.config.slowWaveRatio*n.config.duration2cell,function(){++c===i.size&&(r.globalAlpha=1,n.drawSlots(),n.tutorial4())},n.now())},n.now())}),this.animateScore(n.canvas.get("finger"),i.size+t.coords.length,getPivot(a,[this.cellWidth,this.cellHeight]),this.config.duration7*this.config.slowScoreRatio,this.config.duration2*this.config.slowWaveRatio*.3),this.score+=i.size+t.coords.length}},{key:"tutorial4",value:function(){this.slotHistory=new Map(this.pieceData.map(function(t){return[t,0]})),this.newRound()}},{key:"newGame",value:function(){var t=this;this.overlay||gamee.gameStart(),this.paused=0,this.score=0,this.slotHistory=new Map(this.pieceData.map(function(t){return[t,0]})),this.scene.removeAllAnimations(),this.grid.clear(),["finger","shadow"].forEach(function(e){return t.canvas.get(e).context.clearRect(0,0,t.realWidth,t.height)}),this.newRound()}},{key:"newRound",value:function(){var t=this,e=this;this.newSlots(),this.drawGrid(),e.slots.forEach(function(t){t.state="moving"}),this.playSound("new",0);var o=this.canvas.get("pieces").context;this.scene.addAnimation(function(n){o.clearRect(0,0,t.realWidth,t.height),e.slots.forEach(function(t){t.pos=linterpol(Math.pow(n,2),[t.slot.pos[0],e.height],t.slot.pos),t.size=[config.cellSmallWidth,config.cellSmallHeight],t.size2=t.size.map(function(t){return t*config.cellContentRatio}),t.draw()})},this.config.duration4,function(){e.slots.forEach(function(t){t.state="initial"}),t.evaluate()},this.now())}},{key:"evaluate",value:function(t,e){var o=this,n=this,i=new Map,r=this.slots.every(function(t){return"placed"===t.state})?this.newRound:this.gameplay;if([0,1,2].forEach(function(t){n.diagonals[t].forEach(function(t){t.every(function(t){return void 0!==n.grid.get(t)})&&t.forEach(function(t){return i.set(t,[n.grid2pixel(n.key2grid(t)),n.grid.get(t)])})})}),[].concat(_toConsumableArray(i.keys())).forEach(function(t){return o.grid.delete(t)}),t&&!i.size&&(this.animateScore(n.canvas.get("finger"),t.coords.length,vecAdd(e,t.slot.pOffset),this.config.duration7,0),this.score+=t.coords.length),r===this.gameplay)try{n.slots.filter(function(t){return"placed"!==t.state}).forEach(function(t){return n.coords.forEach(function(e){return n.putPiece(t,e,!0,!0)})}),r=this.gameOver}catch(t){}if(i.size){var a=this.canvas.get("pieces").context;this.playSound("victory",config.duration2cell*config.duration2cellPeakRatio,config.victoryGain);var c=getMaxDistance(i);this.scene.addAnimation(function(){n.drawGrid()},0),this.scene.addAnimation(function(){a.globalAlpha=1,n.drawSlots()},n.config.duration2+n.config.duration2cell,function(){},n.now());var s=0;i.forEach(function(t){var e=_slicedToArray(t,2),o=_slicedToArray(e[0],2),l=o[0],u=o[1],d=e[1],h=getDistance(c,[l,u]);n.scene.addAnimation(function(){a.globalAlpha=1,a.drawImage(d,n.xOffset+n.cellContentOffsetX+l,n.cellContentOffsetY+u,n.cellContentWidth,n.cellContentHeight)},h*n.config.duration2,function(){n.scene.addAnimation(function(t){
var e=wave(t),o=linterpol(e,[l,u],[l+n.cellContentWidth/2,u+n.cellContentHeight/2]),i=_slicedToArray(o,2),r=i[0],c=i[1],s=linterpol(e,[n.cellContentWidth,n.cellContentHeight],[0,0]),h=_slicedToArray(s,2),f=h[0],g=h[1];a.drawImage(d,n.xOffset+n.cellContentOffsetX+r,n.cellContentOffsetY+c,f,g)},n.config.duration2cell,function(){++s===i.size&&(a.globalAlpha=1,n.drawSlots(),r.bind(n)())},n.now())},n.now())}),this.animateScore(n.canvas.get("finger"),i.size+t.coords.length,getPivot(c,[this.cellWidth,this.cellHeight]),this.config.duration7,.3*this.config.duration2),this.score+=i.size+t.coords.length}else r.bind(n)()}},{key:"gameplay",value:function(){var t=this;this.target.ontouchstart=function(e){if(t.overlay&&(t.overlay=0,gamee.gameStart()),!t.paused){var o=t.getMousePos(e),n=_slicedToArray(o,2),i=n[0],r=n[1];try{var a=t.clickedSlot([i,r]);a.state="moving";var c=[i-a.slot.pos2[0],r-a.slot.pos2[1]];new Promise(function(e,o){t.target.ontouchend=o,t.scene.addAnimation(function(e){t.drawSlots(a);var o=Math.pow(e,2);a.pos=linterpol(o,a.slot.pos,a.slot.pos2),a.size=linterpol(o,[config.cellSmallWidth,config.cellSmallHeight],[config.cellWidth,config.cellHeight]),a.size2=linterpol(o,[config.cellSmallWidth*config.cellContentRatio,config.cellSmallHeight*config.cellContentRatio],[config.cellWidth*config.cellContentRatio*config.cellMovingRatio,config.cellHeight*config.cellContentRatio*config.cellMovingRatio]),a.draw()},config.duration1,e,t.now())}).then(function(){var e=-1,o=-1,n=!1;t.target.ontouchmove=function(i){var r=t.getMousePos(i),s=_slicedToArray(r,2),l=s[0],u=s[1];a.pos=[l-c[0],u-c[1]],t.scene.addAnimation(function(){t.drawSlots(a),a.draw()},0,void 0,void 0,void 0,"move");try{var d=t.pixel2grid(a.getPiecePos([l,u]));t.putPiece(a,d,!0);var h=t.canvas.get("shadow").context,f=new Piece(a.coords,h,t.shadows.get(a.img));f.pos=t.grid2pixel(d),f.size=[config.cellWidth,config.cellHeight],f.size2=f.size.map(function(t){return t*config.cellContentRatio}),f.state="moving",e===d[0]&&o===d[1]||t.scene.addAnimation(function(){h.clearRect(0,0,t.realWidth,t.height),f.draw()},0,function(){n=!0},void 0,void 0,"shadow");var g=_slicedToArray(d,2);e=g[0],o=g[1]}catch(i){e=-1,o=-1,n&&t.scene.addAnimation(function(){t.canvas.get("shadow").context.clearRect(0,0,t.realWidth,t.height)},0,function(){n=!1},void 0,void 0,"clearShadow")}},new Promise(function(e,o){t.target.ontouchend=function(n){try{var i=t.pixel2grid(a.getPiecePos(t.getMousePos(n)));t.putPiece(a,i,!0),t.putPiece(a,i,!1);var r=t.grid2pixel(i),c=a.pos;t.playSound("put",0,config.putGain),t.unbindEvents(),t.scene.addAnimation(function(e){t.drawSlots(a);var o=Math.pow(e,3);a.pos=linterpol(o,c,r),a.size2=linterpol(o,[config.cellWidth*config.cellContentRatio*config.cellMovingRatio,config.cellHeight*config.cellContentRatio*config.cellMovingRatio],[config.cellWidth*config.cellContentRatio,config.cellHeight*config.cellContentRatio]),a.draw()},config.duration3,function(){a.state="placed",t.scene.addAnimation(function(){t.canvas.get("shadow").context.clearRect(0,0,t.realWidth,t.height),t.drawGrid(),t.drawSlots(a)},0,function(){return e([a,r])})},t.now())}catch(e){t.scene.removeAllAnimations(),a.state="initial",t.scene.addAnimation(function(){t.drawGrid(),t.drawSlots()},0,o)}finally{t.unbindEvents()}}}).then(function(e){var o=_slicedToArray(e,2),n=o[0],i=o[1];t.unbindEvents(),t.evaluate(n,i)},t.gameplay.bind(t))},function(){t.unbindEvents(),t.scene.removeAllAnimations(),a.state="initial",t.scene.addAnimation(function(){t.drawGrid(),t.drawSlots()},0,t.gameplay.bind(t))})}catch(t){return}}}}},{key:"gameOver",value:function(){this.playSound("gameover",0,config.gameOverGain),gamee.gameOver()}},{key:"initSprites",value:function(){var t=[],e=this;return this.colors.forEach(function(e){t.push([e,"images/Polygon - "+e+"@3x.png"]),t.push([e+"_shadow","images/Polygon - "+e+"@3x_shadow.png"])}),t.push(["background","images/Polygon@3x.png"]),t.push(["hand","images/hand.png"]),preloadImgs(this.sprites,t).then(function(){e.colors.forEach(function(t){e.shadows.set(e.sprites.get(t),e.sprites.get(t+"_shadow"))})},function(t){throw t})}},{key:"init",value:function(){this.initGrid(),this.canvas.get("shadow").context.globalAlpha=.4}},{key:"drawTextCanvas",value:function(t,e,o,n,i,r){t.drawImage(e,o-i/2,n-r/2,i,r)}},{key:"getRowSize",value:function(t){var e=this.size-1,o=t-e;return[this.maxRowSize-Math.abs(o),o]}},{key:"grid2key",value:function(t){var e=_slicedToArray(t,2),o=e[0];return e[1]*this.maxRowSize+o}},{key:"key2grid",value:function(t){return[t%this.maxRowSize,Math.floor(t/this.maxRowSize)]}},{key:"grid2pixel",value:function(t){var e=_slicedToArray(t,2),o=e[0],n=e[1];return[this.cellOffsetX+(Math.abs(this.getRowSize(n)[1])/2+o)*this.cellWidthRatio*this.cellWidth,this.cellOffsetY+n*this.cellHeightRatio*this.cellHeight]}},{key:"pixel2grid",value:function(t){var e=_slicedToArray(t,2),o=e[0],n=e[1],i=Math.floor((n-this.cellOffsetY)/(this.cellHeightRatio*this.cellHeight));if(i<0||i>=this.maxRowSize)throw-1;var r=this.getRowSize(i),a=Math.abs(r[1])/2*this.cellWidthRatio*this.cellWidth,c=Math.floor((o-this.cellOffsetX-a)/(this.cellWidthRatio*this.cellWidth));if(c<0||c>=r[0])throw-1;return[c,i]}},{key:"initGrid",value:function(){for(var t=this,e=0;e<this.size;e++)for(var o=0;o<this.size+e;o++){var n=o,i=this.maxRowSize-(this.size+e)+o,r=this.maxRowSize-e-1;this.axes.set(this.grid2key([o,e]),[e,n,i]),this.axes.set(this.grid2key([o,r]),[r,i,n]);var a=this.grid2key([o,e]),c=this.grid2key([o,r]);this.diagonals[0][e].push(a),this.diagonals[1][n].push(a),this.diagonals[2][i].push(a),r!==e&&(this.diagonals[0][r].push(c),this.diagonals[1][i].push(c),this.diagonals[2][n].push(c))}this.coords=[].concat.apply([],this.diagonals[0]).map(function(e){return t.key2grid(e)});var s=this.sprites.get("background");this.config.cellWidthRatio=this.cellWidthRatio=1-this.config.cellBorderX,this.config.cellHeightRatio=this.cellHeightRatio=(.75*s.height-s.width*this.config.cellBorderX*Math.sqrt(3)/2)/s.height,this.cellOffsetX=.5*this.width*(1-this.config.gridWidth/100),this.cellOffsetY=this.height*this.config.gridYOffset/100,this.config.cellWidth=this.cellWidth=this.width*this.config.gridWidth/100/(this.maxRowSize*this.cellWidthRatio+this.config.cellBorderX),this.config.cellHeight=this.cellHeight=this.cellWidth*s.height/s.width;var l=this.sprites.get("green");this.config.cellContentRatio=1-2*this.config.cellBorderX,this.cellContentWidth=this.cellWidth*this.config.cellContentRatio,this.cellContentHeight=this.cellHeight*this.config.cellContentRatio,this.cellContentOffsetX=(this.cellWidth-this.cellContentWidth)/2,this.cellContentOffsetY=(this.cellHeight-this.cellContentHeight)/2,this.config.cellSmallWidth=this.width/(this.config.slots+1+4*this.config.slots),this.config.cellSmallHeight=this.config.cellSmallWidth*l.height/l.width}},{key:"drawGrid",value:function(){ctx=this.canvas.get("pane").context,ctx.fillStyle="white",ctx.fillRect(0,0,this.realWidth,this.height);for(var t=0;t<this.maxRowSize;t++)for(var e=0;e<this.getRowSize(t)[0];e++){var o=this.grid2pixel([e,t]);ctx.drawImage(this.sprites.get("background"),this.xOffset+o[0],o[1],this.cellWidth,this.cellHeight);var n=this.grid.get(this.grid2key([e,t]));n&&ctx.drawImage(n,this.xOffset+this.cellContentOffsetX+o[0],this.cellContentOffsetY+o[1],this.cellContentWidth,this.cellContentHeight)}}},{key:"getRealDx",value:function(t,e){var o=_slicedToArray(e,2),n=o[0],i=o[1];if(0===i)return n;var r=n===i,a=this.getRowSize(t)[1],c=this.getRowSize(t+i)[1];return a>=0&&c>=0?r?0:n:r?n:0}},{key:"putPiece",value:function(t,e,o,n){var i=this,r=_slicedToArray(e,2),a=r[0],c=r[1],s=!0;if(t.coords.forEach(function(e){var r=_slicedToArray(e,2),l=r[0],u=r[1],d=[a+i.getRealDx(c,[l,u]),c+u];a=d[0],c=d[1],[[a,i.getRowSize(c)[0]],[c,i.maxRowSize]].forEach(function(t){var e=_slicedToArray(t,2),o=e[0],i=e[1];if((o<0||o>=i)&&(s=!1,!n))throw-1});var h=i.grid2key([a,c]);if(i.grid.get(h)&&(s=!1,!n))throw-1;o||i.grid.set(h,t.img)}),n&&s)throw-1}},{key:"newSlots",value:function(){var t=this,e=new Set,o=this.canvas.get("pieces").context;this.slots=[].concat(_toConsumableArray(Array(this.config.slots).keys())).map(function(n){var i=void 0,r=void 0;do{i=t.pieceData[Math.floor(Math.random()*t.pieceData.length)],r=t.slotHistory.get(i)}while(3===r);return t.slotHistory.set(i,r+1),e.add(i),new Piece(i.coords[Math.floor(Math.random()*i.coords.length)],o,t.sprites.get(t.colors[i.color]),n)}),this.pieceData.filter(function(t){return!e.has(t)}).forEach(function(e){return t.slotHistory.set(e,0)})}},{key:"drawSlots",value:function(t){this.canvas.get("pieces").context.clearRect(0,0,this.realWidth,this.height),this.slots.forEach(function(e){e!==t&&e.draw()})}},{key:"clickedSlot",value:function(t){var e=-1;if(this.slots.forEach(function(o){"placed"!==o.state&&o.inside(t)&&(e=o)}),-1===e)throw-1;return e}},{key:"animateScore",value:function(t,e,o,n,i){var r=this,a=prerenderText(e),c=this.config,s=t.context;this.scene.addAnimation(function(t){var e=splitTime(t,c.scoreDelayRatio),n=void 0,i=void 0,l=void 0,u=void 0;if(t<c.scoreDelayRatio){var d=splitTime(e,.25),h=splitTime(d,.7),f=_slicedToArray(o,2);if(n=f[0],i=f[1],e<.25)if(d<.7){var g=linterpol(h,[.5*a.width,.5*a.height],[1.35*a.width,1.35*a.height]),p=_slicedToArray(g,2);l=p[0],u=p[1]}else{var w=linterpol(h,[1.35*a.width,1.35*a.height],[a.width,a.height]),v=_slicedToArray(w,2);l=v[0],u=v[1]}else{var m=[a.width,a.height];l=m[0],u=m[1]}s.globalAlpha=Math.sqrt(1-Math.pow(e-1,2))}else{var y=linterpol(e,o,vecAdd(o,[0,-c.scorePopupRatio*r.cellHeight])),b=_slicedToArray(y,2);n=b[0],i=b[1];var k=[a.width,a.height];l=k[0],u=k[1],s.globalAlpha=Math.sqrt(1-Math.pow(e,2))}s.clearRect(r.xOffset,0,r.width,r.height),r.drawTextCanvas(s,a,r.xOffset+n,i,l,u)},n,function(){},r.now()+i)}}]),e}(Game),Piece=function(){function t(e,o,n,i){_classCallCheck(this,t),this.coords=e,this.ctx=o,this.img=n,this.slot=void 0!==i?this.getSlotPos(i):void 0,this.pos=[0,0],this.size=[0,0],this.size2=[0,0],this.state="initial"}return _createClass(t,[{key:"getSlotPos",value:function(t){var e=window.config,o=e.width/e.slots,n=[(t+.5)*o,e.slotYOffset/100*e.height],i=[(t+.5)*o,e.slotYPopupOffset/100*e.height],r=0,a=0,c=[0,0],s=[0,0];this.coords.forEach(function(t){var o=_slicedToArray(t,2),n=o[0],i=o[1],l=n*e.cellSmallWidth*e.cellWidthRatio*(0===i?1:.5),u=i*e.cellSmallHeight*e.cellHeightRatio,d=[r+l,a+u];r=d[0],a=d[1],[r,a].forEach(function(t,e){t<s[e]&&(s[e]=t)}),[r+e.cellSmallWidth,a+e.cellSmallHeight].forEach(function(t,e){t>c[e]&&(c[e]=t)})});var l=[0,1].map(function(t){return n[t]-(s[t]+c[t])/2}),u=e.cellWidth/e.cellSmallWidth,d=[s,c].map(function(t){return t.map(function(t){return t*u})}),h=_slicedToArray(d,2),f=h[0],g=h[1],p=[0,1].map(function(t){return i[t]-(f[t]+g[t])/2}),w=[0,1].map(function(t){return(f[t]+g[t])/2}),v=[s,c].map(function(t){return t.map(function(t,e){return t+l[e]})}),m=_slicedToArray(v,2);return s=m[0],c=m[1],c=c.map(function(t,e){return t-s[e]+1}),{pOffset:w,pos:l,pos2:p,bounds:[[t*o,Math.min(n[1]-o/2,s[1])],[o-1,Math.max(o,c[1])]]}}},{key:"getPiecePos",value:function(){var t=window.config,e=_slicedToArray(this.pos,2),o=e[0],n=e[1];return[o+t.cellWidth/2,n+t.cellHeight/2]}},{key:"draw",value:function(){var t=this,e=window.config,o=this;if("placed"!==this.state){var n="moving"===this.state?this.pos:this.slot.pos,i=_slicedToArray(n,2),r=i[0],a=i[1],c="moving"===this.state?this.size:[e.cellSmallWidth,e.cellSmallHeight],s="moving"===this.state?this.size2:c.map(function(t){return t*e.cellContentRatio}),l=[0,1].map(function(t){return(c[t]-s[t])/2});this.coords.forEach(function(n){var i=_slicedToArray(n,2),u=i[0],d=i[1],h=u*c[0]*e.cellWidthRatio*(0===d?1:.5),f=d*c[1]*e.cellHeightRatio,g=[r+h,a+f];r=g[0],a=g[1],t.ctx.drawImage(o.img,e.xOffset+r+l[0],a+l[1],s[0],s[1])})}}},{key:"inside",value:function(t){var e=this.slot.bounds;return[0,1].map(function(o){return t[o]>=e[0][o]&&t[o]<=e[0][o]+e[1][o]-1}).every(function(t){return t})}}]),t}(),game=void 0;window.onload=function(){var t=window.setInterval(function(){window.innerHeight&&window.innerWidth&&(window.clearInterval(t),game=new TensGame("Touch",[["pane",0],["shadow",1],["pieces",2],["finger",3]],640,!0))},100)};